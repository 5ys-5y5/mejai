# 질문
select schemaname, tablename, policyname
from pg_policies
where tablename = 'auth_settings'
order by policyname;

| schemaname | tablename     | policyname           |
| ---------- | ------------- | -------------------- |
| public     | auth_settings | auth_settings_read   |
| public     | auth_settings | auth_settings_update |
| public     | auth_settings | auth_settings_write  |

select table_name
from information_schema.tables
where table_schema = 'public'
  and table_name = 'auth_oauth_tokens';

Success. No rows returned

select
  providers->'cafe24' as cafe24
from auth_settings
where org_id = '8ad81b6b-3210-40dd-8e00-9a43a4395923'
  and user_id = 'fa7baaa2-806f-4457-88f0-7d29f802d126';

| cafe24 |
| --- |
| {"scope":"mall.read_application mall.write_application mall.read_category mall.write_category mall.read_product mall.write_product mall.read_collection mall.write_collection mall.read_supply mall.write_supply mall.read_personal mall.write_personal mall.read_order mall.write_order mall.read_community mall.write_community mall.read_customer mall.write_customer mall.read_notification mall.write_notification mall.read_store mall.write_store mall.read_promotion mall.write_promotion mall.read_design mall.write_design mall.read_salesreport mall.read_shipping mall.write_shipping mall.read_translation mall.write_translation mall.read_analytics mall.read_privacy","mall_id":"sungjy2020","shop_no":"1","board_no":"9","client_id":"JAYmwae9LCbAzEWz3vIsdB","expires_at":"2026-01-27T02:46:03.000","access_token":"Rj01VQOiDpKiXXB5IOjq9A","client_secret":"9Nm0W86KMl3oSbxrrwdeaC","refresh_token":"BdcEjgDuN57hRMCO42gvnD"} |

PS C:\dev\1227\mejai> $token = "Rj01VQOiDpKiXXB5IOjq9A";
>> Invoke-RestMethod -Method Get `
>>   -Uri "https://sungjy2020.cafe24api.com/api/v2/admin/customers?shop_no=1&member_id=mejai" `
>>   -Headers @{ Authorization = "Bearer $token" }

customers
---------
{@{shop_no=1; member_id=mejai; group_no=1; member_authenticat

PS C:\dev\1227\mejai> Invoke-RestMethod -Method Get `
>>   -Uri "https://sungjy2020.cafe24api.com/api/v2/admin/orders/20260127-0000014?shop_no=1" `
>>   -Headers @{ Authorization = "Bearer $token" }

order
-----
@{shop_no=1; currency=KRW; order_id=20260127-0000014; market_

PS C:\dev\1227\mejai>

# 답변
모든 체크 항목이 **정상 동작/존재 확인**되었습니다.

체크리스트 상태
- `auth_settings` RLS 정책 3종 존재: 확인됨
- `auth_oauth_tokens` 테이블 제거: 확인됨
- `providers.cafe24` 필수 키 존재: 확인됨
- 최신 토큰으로 **customers/order 조회 성공**: 확인됨 (`member_id=mejai`, `order_id=20260127-0000014`)

이제 MCP 경로에서도 동일하게 동작하는지 확인만 하면 완료입니다. 다음 테스트를 진행해 주세요.

```js
const key = Object.keys(localStorage).find(k => k.includes("auth-token"));
const raw = localStorage.getItem(key || "");
const token = raw ? (JSON.parse(raw).access_token || JSON.parse(atob(raw)).access_token) : "";

fetch("/api/mcp/tools/call", {
  method: "POST",
  headers: { "Content-Type": "application/json", "Authorization": "Bearer " + token },
  body: JSON.stringify({ tool: "find_customer_by_phone", params: { member_id: "mejai" } })
}).then(r => r.json()).then(console.log);

fetch("/api/mcp/tools/call", {
  method: "POST",
  headers: { "Content-Type": "application/json", "Authorization": "Bearer " + token },
  body: JSON.stringify({ tool: "lookup_order", params: { order_id: "20260127-0000014", customer_verification_token: "TEST" } })
}).then(r => r.json()).then(console.log);
```

위 결과까지 성공하면 1차 목표(환경 변수 없이 Cafe24 MCP 정상 작동) 완료입니다.
