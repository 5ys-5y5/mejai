# 상세 테스트 가이드

## 1단계: 개발 서버 실행

터미널에서 다음 명령어를 실행합니다:

```bash
npm run dev
```

서버가 실행되면 `http://localhost:3000`에서 접속 가능합니다.

---

## 2단계: 로그인

1. 브라우저에서 `http://localhost:3000/login` 접속
2. 계정 정보를 입력하여 로그인
3. 로그인 성공 시 `/app` 대시보드로 자동 이동

---

## 3단계: 브라우저 개발자 콘솔 열기

### Windows/Linux:
- **F12** 키를 누르거나
- **Ctrl + Shift + I** 키를 누르거나
- 브라우저 우측 상단 메뉴 → "도구 더보기" → "개발자 도구"

### Mac:
- **Cmd + Option + I** 키를 누르거나
- 브라우저 메뉴 → "개발자용" → "개발자 도구 표시"

### 개발자 도구가 열리면:
- 화면 하단 또는 우측에 패널이 나타납니다
- 상단 탭 중에서 **"Console"** 탭을 클릭합니다
- `>` 프롬프트가 있는 입력창이 보이면 준비 완료

---

## 4단계: 시뮬레이션 데이터 생성

### 4-1. Supabase 클라이언트 확인

콘솔 입력창에 다음을 입력하고 **Enter**:

```javascript
console.log(typeof supabase)
```

- `"object"`가 출력되면 정상
- `"undefined"`가 출력되면 페이지에 supabase 클라이언트가 없는 것입니다
  - 이 경우 먼저 Supabase 클라이언트를 전역으로 설정해야 합니다

### 4-2. 시뮬레이션 API 호출

콘솔 입력창에 다음 코드를 **복사해서 붙여넣고** **Enter**:

```javascript
const { data } = await supabase.auth.getSession();
await fetch("/api/simulate-call", {
  method: "POST",
  headers: { 
    "Authorization": `Bearer ${data.session.access_token}`,
    "Content-Type": "application/json"
  },
  body: JSON.stringify({ escalated: true })
}).then(res => res.json()).then(result => {
  console.log("✅ 시뮬레이션 데이터 생성 완료:", result);
});
```

**주의사항:**
- 코드를 한 번에 전체 복사해서 붙여넣어야 합니다
- 여러 줄이어도 괜찮습니다
- Enter를 누르면 실행됩니다
- 성공하면 "✅ 시뮬레이션 데이터 생성 완료:" 메시지와 함께 생성된 세션 정보가 출력됩니다

### 4-3. 여러 개 생성하기

더 많은 테스트 데이터를 생성하려면 위 코드를 여러 번 실행하거나, 다음 코드로 한 번에 여러 개 생성:

```javascript
// 이관된 통화 3개, 정상 완료 통화 2개 생성
for(let i = 0; i < 3; i++) {
  const { data } = await supabase.auth.getSession();
  await fetch("/api/simulate-call", {
    method: "POST",
    headers: { 
      "Authorization": `Bearer ${data.session.access_token}`,
      "Content-Type": "application/json"
    },
    body: JSON.stringify({ escalated: true })
  });
}

for(let i = 0; i < 2; i++) {
  const { data } = await supabase.auth.getSession();
  await fetch("/api/simulate-call", {
    method: "POST",
    headers: { 
      "Authorization": `Bearer ${data.session.access_token}`,
      "Content-Type": "application/json"
    },
    body: JSON.stringify({ escalated: false })
  });
}

console.log("✅ 총 5개의 시뮬레이션 데이터 생성 완료");
```

---

## 5단계: 화면별 기능 확인

### 5-1. 대시보드 (/app)

브라우저 주소창에 `http://localhost:3000/app` 입력

**확인 사항:**
- 통화 수가 증가했는지
- 이관률(Escalation Rate)이 표시되는지
- 가장 많이 호출된 에이전트 차트가 업데이트되는지

**새로고침:**
- F5 키를 누르거나 새로고침 버튼을 클릭하여 최신 데이터 확인

### 5-2. 통화 목록 (/app/calls)

브라우저 주소창에 `http://localhost:3000/app/calls` 입력

**확인 사항:**
- 방금 생성한 세션들이 목록에 표시되는지
- 각 세션의 상태(completed/escalated)가 표시되는지
- 날짜/시간이 표시되는지

### 5-3. 통화 상세 (/app/calls/{id})

통화 목록에서 **하나의 세션을 클릭**하거나, 콘솔에서 반환된 세션 ID를 사용:

`http://localhost:3000/app/calls/{여기에-세션-id-붙여넣기}`

**확인 사항:**
- 턴(Turn) 목록이 표시되는지
- 각 턴의 ASR 텍스트가 보이는지
- 대화 요약(Summary)이 표시되는지
- 오디오 구간 정보가 있는지

### 5-4. 후속 지원 요청 (/app/review)

브라우저 주소창에 `http://localhost:3000/app/review` 입력

**확인 사항:**
- 이관된 통화(`escalated: true`)가 목록에 표시되는지
- 각 요청의 우선순위, 고객 정보 등이 표시되는지

### 5-5. 지식 베이스 (/app/kb)

브라우저 주소창에 `http://localhost:3000/app/kb` 입력

**확인 사항:**
- 기존 KB 문서 목록이 조회되는지
- (아직 생성 기능이 없다면) 읽기 전용으로 목록만 표시

---

## 6단계: API 직접 테스트 (선택사항)

개발자 콘솔에서 API를 직접 호출하여 응답 확인:

### 세션 목록 조회:
```javascript
const { data } = await supabase.auth.getSession();
const sessions = await fetch("/api/sessions", {
  headers: { "Authorization": `Bearer ${data.session.access_token}` }
}).then(res => res.json());
console.log("세션 목록:", sessions);
```

### 특정 세션의 턴 조회:
```javascript
const { data } = await supabase.auth.getSession();
const sessionId = "여기에-세션-id-입력";
const turns = await fetch(`/api/sessions/${sessionId}/turns`, {
  headers: { "Authorization": `Bearer ${data.session.access_token}` }
}).then(res => res.json());
console.log("턴 목록:", turns);
```

### 후속 지원 요청 목록 조회:
```javascript
const { data } = await supabase.auth.getSession();
const reviews = await fetch("/api/review-queue", {
  headers: { "Authorization": `Bearer ${data.session.access_token}` }
}).then(res => res.json());
console.log("후속 지원 요청:", reviews);
```

---

## 문제 해결

### "supabase is not defined" 오류가 나는 경우:

페이지에서 Supabase 클라이언트가 전역으로 노출되지 않았을 수 있습니다. 
다음 방법으로 직접 세션 토큰을 가져와서 사용:

```javascript
// localStorage에서 직접 토큰 가져오기
const session = JSON.parse(localStorage.getItem("sb-{your-project-ref}-auth-token"));
const accessToken = session.access_token;

// 이후 API 호출 시 사용
await fetch("/api/simulate-call", {
  method: "POST",
  headers: { 
    "Authorization": `Bearer ${accessToken}`,
    "Content-Type": "application/json"
  },
  body: JSON.stringify({ escalated: true })
});
```

### 401 Unauthorized 오류가 나는 경우:

- 로그인이 만료되었을 수 있습니다 → 다시 로그인
- 토큰이 올바르지 않습니다 → 개발자 콘솔을 새로고침하고 다시 시도

### 데이터가 화면에 표시되지 않는 경우:

- 페이지를 새로고침(F5)
- 브라우저 캐시 삭제 (Ctrl+Shift+Delete)
- 개발자 도구의 Network 탭에서 API 요청/응답 확인

---

## 요약

1. `npm run dev`로 서버 실행
2. `/login`에서 로그인
3. **F12**로 개발자 콘솔 열기
4. **Console 탭**에서 시뮬레이션 코드 붙여넣기 + Enter
5. 각 페이지(`/app`, `/app/calls`, `/app/review` 등) 방문하여 데이터 확인
6. 새로고침하여 최신 상태 반영

이제 개발자 콘솔을 통해 쉽게 테스트 데이터를 생성하고 각 기능을 확인할 수 있습니다!
