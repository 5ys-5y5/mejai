# 질문
member_id=mejai
order_id=20260127-0000014

위 두 정보로 아래의 구현 상태를 점검해주세요.

    - [x] `src/lib/mcpAdapters.ts`에서 Cafe24 설정을 `auth_settings.providers.cafe24`에서 읽도록 구현되어 있다.
    - [x] `src/app/api/cafe24/authorize/route.ts`가 DB(auth_settings)에서 `mall_id`, `client_id`, `scope`를 읽는다.
    - [x] `src/app/api/cafe24/callback/route.ts`가 DB(auth_settings)에 토큰을 저장한다.
    - [x] `src/app/api/mcp/tools/call/route.ts`가 `callAdapter`에 `supabase/orgId/userId` 컨텍스트를 전달한다.
    - [x] `src/app/api/mcp/tools/route.ts`에 `MCP_TOKEN` 환경변수 fallback이 제거되어 있다.
    - [x] `auth_settings` 테이블 존재
    - [x] `auth_oauth_tokens` 테이블 제거됨(사용하지 않음)
    - [x] `auth_settings`의 RLS 정책(`auth_settings_read/write/update`) 존재
    - [x] `providers.cafe24`에 다음 키가 존재
      - [x] `mall_id`
      - [x] `client_id`
      - [x] `client_secret`
      - [x] `scope`
      - [x] `access_token`
      - [x] `refresh_token`
      - [x] `expires_at`
      - [x] `shop_no` (선택)
      - [x] `board_no` (선택)
    - [x] `org_id` / `user_id`가 현재 로그인 유저와 일치

# 답변
아래는 **코드 기준 점검 결과**와 **DB/실데이터 확인용 쿼리**입니다. `member_id=mejai`, `order_id=20260127-0000014`는 **데이터 확인용**으로 아래 쿼리를 실행해 확인해 주세요.

코드 점검 (로컬 파일 기준)
- `src/lib/mcpAdapters.ts`가 `auth_settings.providers.cafe24`를 읽고 있음: 확인됨 (`getCafe24Config`)
- `src/app/api/cafe24/authorize/route.ts`가 DB에서 `mall_id/client_id/scope` 읽음: 확인됨
- `src/app/api/cafe24/callback/route.ts`가 DB에 토큰 저장: 확인됨
- `src/app/api/mcp/tools/call/route.ts`가 `callAdapter`에 `supabase/orgId/userId` 전달: 확인됨
- `src/app/api/mcp/tools/route.ts`에 `MCP_TOKEN` fallback 제거: 확인됨

DB/정책 확인(직접 실행 필요)
1) `auth_settings` 존재 및 RLS 정책 확인
```sql
select schemaname, tablename, policyname
from pg_policies
where tablename = 'auth_settings'
order by policyname;
```

2) `auth_oauth_tokens` 제거 여부 확인
```sql
select table_name
from information_schema.tables
where table_schema = 'public'
  and table_name = 'auth_oauth_tokens';
```

3) `providers.cafe24` 키 확인
```sql
select
  providers->'cafe24' as cafe24
from auth_settings
where org_id = '8ad81b6b-3210-40dd-8e00-9a43a4395923'
  and user_id = 'fa7baaa2-806f-4457-88f0-7d29f802d126';
```

데이터 기준 확인 (member_id/order_id)
1) `member_id=mejai` 고객 조회
```powershell
$token = "Rj01VQOiDpKiXXB5IOjq9A";
Invoke-RestMethod -Method Get `
  -Uri "https://sungjy2020.cafe24api.com/api/v2/admin/customers?shop_no=1&member_id=mejai" `
  -Headers @{ Authorization = "Bearer $token" }
```

2) `order_id=20260127-0000014` 주문 조회
```powershell
Invoke-RestMethod -Method Get `
  -Uri "https://sungjy2020.cafe24api.com/api/v2/admin/orders/20260127-0000014?shop_no=1" `
  -Headers @{ Authorization = "Bearer $token" }
```

위 결과를 주시면 “구현 체크리스트”의 **데이터 연동 정상 여부**까지 최종 확정 가능합니다.
