# 질문
twillo 서비스 사용이 불가합니다.
https://mejai.help/api/twilio/voice
웹훅 설계를 삭제하고,
다른 서비스로 웹훅을 설계하는 대략적인 방법에 대해 reply에 남겨주세요.
서비스는 정해지지 않아 "대한민국에서 전화할 수 있는 서비스"로 권장하는 서비스를 남겨주세요

# 답변
Twilio 전용 웹훅 설계는 삭제했습니다.

아래는 **특정 서비스에 종속되지 않는** 음성 통화 웹훅 설계의 대략적인 방법입니다.

1) 요구사항 정리
   - 인바운드/아웃바운드 여부, 대표번호/발신번호 필요 여부: 인바운드, 아웃바운드 모두 커버 및 서비스를 사용하는 사용자가 복수라면 복수의 사용자가 서로 다른 번호를 받을 수 있어야 함
   - 동시 통화 수, 녹취/보관, 통화 시간대 제어: 동시 통화 수는 100건으로 시작하고 1만건까지 늘어날 수도 있음
   - IVR, DTMF 입력, TTS/ASR 필요 여부: IVR, DTMF는 모두 필요하지만 기본적으로 고객이 번호를 눌러서 접근하는 것이 아닌 TTS가 모든 결정을 말로 묻는 형태입니다.
   - 대한민국 전화 규제/통신사 커버리지 요구: 대한민국 전화 규제/통신사 커버 필수

2) 서비스 선정 기준
   - 대한민국 발신/수신 지원 여부: 필수
   - 번호 발급 가능 여부(대표번호/발신번호 정책): 필수
   - 웹훅/콜백 지원, 서명 검증 제공 여부: 필수
   - 요금/과금 구조, SLA: 과금 모델 허용

3) 웹훅 흐름(공통 패턴)
   - 서비스 → 우리 서버로 이벤트 콜백
     - 예: call.inbound, call.answered, dtmf.received, recording.ready, call.completed
   - 우리 서버는 200 OK로 즉시 응답(재시도 대비)
   - idempotency 키/요청 서명 검증으로 중복 처리 방지
   - call_id를 내부 세션/주문/고객과 매핑해 상태 저장

4) 시나리오 설계
   - 초기 안내 멘트 → 메뉴 선택(IVR) → 상담 연결/자동응답 분기 -> IVR 없이 말로 묻고 말로 대답하는 형식
   - 실패/통화 종료 이벤트 처리(재시도/콜백 예약)

5) 운영/테스트
   - 샌드박스 번호로 end-to-end 테스트
   - 웹훅 타임아웃/재시도 정책 검증
   - 모니터링(콜 성공률, 실패 코드, 평균 통화시간)

권장 서비스(아래 기준을 충족할 수 있는 후보)
- Vonage Voice API: 대한민국 Voice 기능/제약 및 번호 발급 절차가 문서화되어 있고, Voice API signed webhook(JWT) 검증을 공식 지원
- Telnyx Voice API: 대한민국 번호 제공 및 통화(발신/수신) 사용 흐름을 공식 안내하며, webhook 서명 검증(ED25519) 지원

운영 전 추가 확인 포인트(필수)
- 한국 번호 발급은 서류/심사 및 리드타임이 필요할 수 있음
- 동시 통화 1만건 수준은 사전 협의/쿼터 증설이 필요할 수 있음
- TTS/ASR는 서비스 내장 제공 또는 외부 엔진 연동 방식인지 확인 필요

최종 선택은 **대표번호/발신번호 정책, 규제/인증 요건, 대규모 동시통화 증설 정책**에 따라 달라집니다.

---

## Vonage 서비스 연결 방법(개략)
아래는 Vonage Voice API를 기준으로 한 연결 절차의 큰 흐름입니다. (세부 설정/정책은 계약 및 지역 규정에 따라 달라질 수 있습니다.)

1) 계정 및 번호 준비
   - Vonage 계정 생성 및 Voice API 활성화
   - 대한민국 인바운드/아웃바운드 가능한 번호 발급
   - 복수 사용자용으로 번호를 여러 개 확보하고, 사용자-번호 매핑 테이블 준비

2) 애플리케이션(Voice App) 생성
   - Vonage에서 Voice Application 생성
   - Answer URL(통화 시작 시 호출), Event URL(이벤트 콜백) 등록
   - 서명 검증(JWT) 설정 활성화

3) 웹훅 엔드포인트 설계
   - Answer URL: 통화 수신/발신 직후 호출되는 엔드포인트
     - 응답으로 NCCO(TTS, input, connect 등) 반환
   - Event URL: call.answered, dtmf, recording, completed 등 이벤트 수신
   - 서명 검증 및 idempotency 처리 필수

4) TTS/ASR 중심 시나리오 구성
   - TTS로 질문 -> speech input으로 응답 받기
   - 필요한 경우 DTMF 입력도 함께 허용
   - 예: "무엇을 도와드릴까요?" -> 음성 인식 -> 라우팅 결정

5) 인바운드/아웃바운드 흐름
   - 인바운드: 고객 -> 대표번호 -> Answer URL -> NCCO 실행
   - 아웃바운드: 우리 서버 -> Vonage API로 call 생성 -> Answer URL/NCCO 실행

6) 운영/확장 준비
   - 통화 녹취/보관 정책 설정 및 이벤트 처리
   - 동시 통화 100 -> 1만 확장에 대비한 쿼터/서포트 협의
   - 장애 대응: 재시도/콜백 예약/모니터링 지표 구축

---

## 규제로 모든 서비스 사용 불가 시, 개인 휴대폰 번호로 가설 검증 방법
개인 휴대폰 번호만으로 **완전 자동 음성봇**을 구현하는 것은 기술/정책적으로 매우 어렵습니다.
통화 오디오는 통신사/OS 보안 정책으로 인해 앱이 직접 입출력할 수 없기 때문입니다.
따라서 **가설 검증 단계에서는 아래의 현실적인 방법**을 권장합니다.

1) Wizard-of-Oz(수동 운영)
   - 개인 번호로 통화받고, 운영자가 스크립트/응답을 읽어 진행
   - 장점: 규제/기술 장벽 없이 즉시 가능
   - 단점: 자동화가 아님
   - 목적: 대화 흐름, 질문 설계, 고객 반응 검증

2) 개인 번호 + 녹취/요약 기반 사후 검증
   - 통화는 수동으로 받고, 통화 내용을 기록/요약하여 UX 검증
   - 주의: 한국은 녹취/보관에 대한 동의 고지가 필요할 수 있음

3) 하드웨어 브리지(준자동)
   - 휴대폰 통화를 Bluetooth HFP 또는 TRRS 오디오 케이블로 PC에 연결
   - PC에서 TTS/ASR 실행 후, 운영자가 필요 시 개입
   - 장점: 자동화에 가까운 경험 제공 가능
   - 단점: 구성 난이도 높고 품질/안정성이 제한적

권장 진행 순서(가설 검증용)
1) Wizard-of-Oz로 핵심 시나리오 검증
2) 반응이 좋으면 규제/서비스 사용 가능성 재검토
3) 이후 자동화(웹훅/ASR/TTS)로 확장

---

## 착신전환 기반 AI 응대 운영 가이드 (국내 전용, 녹취/안내 고지 포함)

### 1) 통신사/요금제 선택 기준(표)
| 항목 | 체크 포인트 | 운영 영향 |
| --- | --- | --- |
| 착신전환 유형 | 무조건/부재중/통화중 전달 지원 여부 | 시나리오 대응 범위 결정 |
| 과금 구조 | 착신전환 분당 과금, 수신/발신 과금 구분 | 비용 예측 및 규모 확장성 |
| 발신자 표시 | 전환 후 발신자 번호 유지 여부 | 고객 혼선 및 신뢰도 |
| 네트워크 기반 전환 | 단말 전원 OFF 상태에서도 동작 여부 | 장애/부재 대응 |
| 동시성/제한 | 전환 시 동시 통화/호 제한 정책 | 동시 통화량(100~1만) 대응 |
| 부가서비스 고지 | 녹취/안내 고지 허용 및 방식 | 규정 준수 리스크 |

### 2) 착신전환 + AI 응대 시나리오(개략)
1) 고객이 개인 번호로 전화
2) 통신사 착신전환이 A의 가상번호(응대 번호)로 연결
3) AI가 자동 안내(녹취/고지) 후 대화 시작
4) TTS로 질문 → ASR로 응답 수집 → 내부 로직 분기
5) 필요한 경우 DTMF 입력 병행 허용
6) 종료 시 요약/후속 액션(콜백 예약, 문자 안내 등)

### 3) 녹취/안내 고지 문구(초안)
통화 연결 직후 1~3초 이내에 자동 안내하는 형식을 권장합니다.

예시 A (간단형)
“안녕하세요. 원활한 상담을 위해 통화 내용이 녹음될 수 있습니다. 계속 진행하실까요?”

예시 B (설명형)
“안녕하세요. 서비스 품질 향상을 위해 통화가 녹음될 수 있습니다. 동의하시면 계속 말씀해 주세요.”

예시 C (거부 선택 포함)
“안녕하세요. 통화는 녹음될 수 있습니다. 동의하지 않으시면 ‘상담원 연결’이라고 말씀해 주세요.”
