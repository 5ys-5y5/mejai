# 질문
.env 파일에 SUPABASE_SERVICE_ROLE_KEY로 명명을 변경하고, CRON_SECRET를 추가하였습니다.

# 답변
변경 적용했습니다. Cron용 Cafe24 토큰 갱신 엔드포인트와 공용 토큰 모듈을 추가했고, 기존 요청-시 갱신 로직은 그대로 유지했습니다.

변경 내용
- `src/lib/cafe24Tokens.ts`: 만료 판단 + refresh 로직 공용화
- `src/lib/supabaseAdmin.ts`: `SUPABASE_SERVICE_ROLE_KEY`(fallback: `NEXT_PUBLIC_SUPABASE_SERVICE_ROLE_KEY`)로 admin client 생성
- `src/app/api/cafe24/refresh/route.ts`: CRON_SECRET 보호, 만료 임박만 갱신, 전체 요약 리턴
- `src/lib/mcpAdapters.ts`: 공용 refresh/만료 판단으로 교체
- `docs/단계별_구현_체크리스트_및_검증.md`: 주기 갱신 항목 추가

로컬 확인
```powershell a
npm run dev
```
```powershell b
curl -H "x-cron-secret: 7QqGsidEu8L9M1RmRJ1ev56wABqMC10r" http://localhost:3000/api/cafe24/refresh
```
로컬 호출도 운영 DB를 갱신합니다.

다음 단계
1. Railway 환경 변수에 `SUPABASE_SERVICE_ROLE_KEY`, `CRON_SECRET` 설정
2. Railway Cron Job: 30분 주기로 `https://mejai.help/api/cafe24/refresh` 호출
3. Supabase에서 `auth_settings.providers.cafe24.access_token`/`expires_at` 갱신 확인
