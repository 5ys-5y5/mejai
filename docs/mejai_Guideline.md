# 유선 전화 기반 AI 상담봇 MVP PRD 및 운영자 콘솔

## 0. 문서 목적 및 범위
이 문서는 **유선 전화(Voice) 채널**에서 동작하는 AI 상담봇의 MVP를 정의한다. MVP는 다음을 동시에 달성한다.

1) 고객 통화 내용을 **원문 전사(ASR) → 요약 → 확인(되묻기) → 답변(RAG)**의 표준 플로우로 처리
2) ASR이 불안정할 때 고객이 **전화번호로 매칭되는 웹 페이지에서 텍스트 입력**을 통해 동일 세션에서 응답을 받을 수 있도록 지원
3) 사업체(운영자) 관점에서 **로그·통계·평가·지식 갱신**을 통해 “AI가 부담 없이 처리 가능한 문의”를 지속적으로 확장
4) 모든 대화 내용을 **음성 녹음 파일 + 텍스트(전사/요약/확인/응답)** 형태로 기록

추가 요구(프로젝트 운영 방식):
- 구현은 **단계적으로** 진행하며, 각 단계는 **완료 기준(Exit Criteria)과 점검(Validation)** 을 통과해야 다음 단계로 진행한다.
- LLM/운영자/개발자가 언제든 현재 진행 단계, 완료 여부, 이슈 및 해결 상태를 식별할 수 있도록 **단계별 ToDo/체크리스트를 별도 문서로 관리**한다.
  - 별도 문서명(본 프로젝트): **“단계별 구현 체크리스트 및 검증(Exit Criteria)”**

---

## 1. 용어 정의
- **ASR**: Automatic Speech Recognition, 음성→텍스트 전사
- **TTS**: Text-to-Speech, 텍스트→음성 송출
- **Orchestrator**: 대화 상태·가드레일·RAG·라우팅을 수행하는 봇 서버
- **KB(지식 베이스)**: CS 내규/FAQ/약관/공지 등 문서 저장소 + 검색 인덱스(RAG)
- **MCP**: 모델 행동 통제 계층. 권한 경계, 금지/허용 행위, 에스컬레이션, 출력 형식 규칙을 포함
- **세션(Session)**: 한 통화(또는 통화 중 웹 입력 포함)에서 발생하는 대화 단위
- **턴(Turn)**: 고객 발화 및 이에 대응하는 시스템 처리의 한 단위

---

## 2. 사용자(고객) 경험 플로우(표준 프로세스)
아래 1~8 단계는 모든 세션에서 **로그로 남아야 하며** 운영자 콘솔에서 재생/검토 가능해야 한다.

### 2.1 표준 플로우(요구된 1~8 구조)
1. **질문자(고객)가 말한다.**
2. 서비스가 이를 **텍스트로 그대로 받아 적는다(원문 전사)**.
3. 서비스가 이를 **요약**한다.
4. 서비스가 질문자에게 **내용 확인을 요청(되묻기)** 한다.
5. 질문자가 **대답한 내용을 기록**한다(확인/정정).
6. 문제가 있다면 1~5를 반복하고, 없다면 **MCP + KB(RAG)**를 통해 답변한다.
7. 도움이 됐다면 **1**, 전혀 아니라면 **2**를 누르게 한다(만족도).
8. 추가 질문이 있는지 묻고 있다면 1~5를 반복한다.

### 2.2 텍스트 1단계 / 음성 2단계 원칙
- 1단계(기본): 시스템은 **항상 텍스트로 생성/저장**한다.
- 2단계(옵션): 통화에 **TTS로 음성 송출**한다. (텍스트 생성이 선행)

---

## 3. 기능 명세 (MVP)

### 3.1 고객 측 기능

#### F-C1. 통화 시작 안내 및 동의
- AI 처리/녹음/텍스트 전사에 대한 고지 및 동의
- 미동의 시: 사람 상담원 연결 또는 콜백 티켓

#### F-C2. 전사(ASR) 수집 및 턴 분리
- 고객 발화를 구간화(침묵/중복/잡음 처리)
- 각 턴마다 원문 전사를 생성

#### F-C3. 요약 생성 및 확인(되묻기)
- 요약 포맷(필수):
  - 고객 목적(카테고리)
  - 핵심 사실 3~5개
  - 필요한 추가 질문(있을 경우 1~2개)
- 확인 질문 스크립트(텍스트 기반):
  - “정리하면, … 맞으면 ‘네’, 다르면 수정할 부분을 말씀해 주세요.”
- 확인 루프 제한: 기본 2회. 2회 실패 시 웹 입력 또는 에스컬레이션

#### F-C4. KB 기반 답변(RAG)
- 확인 완료된 요약/정제 질문으로 KB 검색
- 근거 부족 시 단정 금지(“확인이 필요합니다”)
- 답변 포맷(필수): 결론 → 조건/근거 → 다음 단계

#### F-C5. 웹 입력 보조(전화번호 매칭)
- 트리거: ASR 불안정, 고객 요청, 소음/통화품질 저하 등
- 전화번호+세션 토큰으로 매칭되는 페이지 제공
- 입력된 텍스트는 해당 세션의 “단일 진실 소스”로 우선 적용

#### F-C6. 만족도 수집(1=도움, 2=도움 안 됨)
- DTMF 입력(키패드) 또는 음성으로 수집(가능하면 DTMF 우선)

#### F-C7. 추가 질문 루프
- “추가로 도와드릴까요?” → 있으면 2.1의 1~5 반복

---

### 3.2 사업체(운영자) 측 기능: 운영자 콘솔(필수)

운영자 콘솔은 ‘AI가 부담 없이 처리 가능한 문의’를 지속적으로 확장하기 위한 **운영 시스템**이다. 따라서 로그 열람뿐 아니라, 통계/평가/지식 갱신/정책(MCP) 조정이 한 흐름으로 연결되어야 한다.

#### 3.2.0 운영자 콘솔 페이지 구성(IA) 및 흐름

**A) 인증/온보딩(최초 1회)**
- 가입(Sign up) → 이메일 검증(Verify) → 로그인(Login)
- 온보딩(Onboarding) 단계에서 다음을 완료해야 콘솔 접근 가능:
  1) 사업체(Organization) 생성
  2) 유선 번호/전화 플랫폼 연결(또는 연결 대기)
  3) 기본 CS 정책/FAQ 업로드(또는 샘플 KB 선택)
  4) 보존기간/녹취 동의 스크립트 기본값 설정

**B) 일상 운영 루프(반복)**
- (대시보드) 오늘/이번주 문의 트렌드 확인
- (통화 로그) 대표 케이스 검토(음성+텍스트)
- (리뷰 큐) ‘도움 안 됨(2)’ 또는 에스컬레이션 케이스 개선
- (KB) 문서 추가/수정 및 버전 배포
- (규칙) MCP/에스컬레이션 기준 조정
- (재측정) 지표 개선 확인

**C) 핵심 화면 목록(최소)**
- /app (대시보드(통계))
- /app/calls (통화 리스트)
- /app/calls/{session_id} (통화 상세)
- /app/eval (대체 용이성 평가)
- /app/kb (지식 베이스)
- /app/rules (MCP/라우팅/에스컬레이션)
- /app/review (개선 큐)
- /app/team (권한)
- /app/settings (정책/보존/마스킹)
- /app/audit (감사)

#### F-B1. 세션/턴 로그 뷰어(실제 로그 열람)
. 세션/턴 로그 뷰어(실제 로그 열람)
운영자는 다음을 **세션 단위로 재생/조회**할 수 있어야 한다.
- 음성 녹음 파일(전체) + 구간별(턴별) 재생
- 턴별 **원문 전사(2)**
- 턴별 **요약(3)**
- 확인 요청 텍스트(4)
- 고객 확인/정정 응답(5)
- 최종 답변 텍스트(6)
- 만족도 입력(7)
- 추가 질문 루프의 반복 구조(8)

필터/검색:
- 기간, 카테고리, 만족도(1/2), 에스컬레이션 여부/사유, 키워드, 전화번호(권한자만)

#### F-B2. 문의 분류/트렌드 대시보드(가장 많은 문의 파악)
- 카테고리별 문의량(일/주/월)
- 상위 키워드/문구(전사/요약 기반)
- 만족도(도움/비도움) 분포
- 에스컬레이션률(사유별)
- 평균 통화 시간(AHT), 확인 루프 실패율

#### F-B3. “AI 대체 용이성” 평가/관리
운영자는 문의 유형별로 다음을 평가할 수 있어야 한다.
- **대체 용이성 등급**(예: A/B/C)
  - A: AI만으로 처리 가능(정책/FAQ로 충분)
  - B: AI+정보추가(몇 가지 질문 후 처리)
  - C: 사람 필수(분쟁/예외/보안/복잡)
- 등급 결정 근거:
  - 근거 문서 존재 여부
  - 오답 리스크(금전/법무/보안)
  - 필요한 본인확인 수준
  - 고객 불만/민원 빈도

운영자는 등급을 바꾸면서 **자동 라우팅 규칙(MCP)**에 반영할 수 있어야 한다.

#### F-B4. 지식 베이스 관리(문서/버전/적용 범위)
- 정책/FAQ 문서 등록·수정·비활성화
- 버전/시행일 관리(구버전 혼입 방지)
- 공개 가능 여부(외부 인용 허용/금지) 메타데이터
- 변경 후 재인덱싱(배치/즉시)

#### F-B5. 품질 개선 워크플로(학습이 아닌 ‘운영 개선’ 중심)
- “도움 안 됨(2)” 세션을 자동 큐에 넣기
- 운영자가:
  - 정답(권장 답변)을 입력
  - 필요한 KB 문서 추가/수정 포인트를 태깅
  - 향후 에스컬레이션 룰 조정 제안
- 결과:
  - KB 갱신 / MCP 룰 갱신 / 스크립트 갱신으로 반영

#### F-B6. 권한/감사(Audit) 및 개인정보 보호
- 역할 기반 접근(예: Admin/QA/상담원)
- 전화번호/개인정보 마스킹 기본, 권한자만 원문 접근
- 로그 조회/다운로드 감사 로그

---

## 4. 데이터/저장/보존 정책(필수)

### 4.1 저장해야 하는 레코드(최소)
- 세션 메타: session_id, 시작/종료 시각, 발신번호(마스킹), 라우팅 결과
- 음성: 전체 녹음 파일 + (가능하면) 턴별 타임스탬프
- 텍스트:
  - 턴별 원문 전사
  - 턴별 요약
  - 확인 요청 문구
  - 고객 확인/정정 응답
  - 최종 답변 텍스트
  - 만족도(1/2)
  - 에스컬레이션 여부/사유
- KB 참조:
  - 검색된 문서 ID/버전, 사용된 근거 조각

### 4.2 데이터 분류
- P0 민감: 결제수단/인증정보 등(입력 유도 금지)
- P1 개인정보: 전화번호, 이름, 주소, 주문번호
- P2 업무정보: 문의 내용, 제품/서비스 정보

### 4.3 보존 기본값(정책에 따라 조정)
- 음성/전사: 기본 30일(예시)
- 품질 통계/비식별 지표: 1년

---

## 5. 권한 경계(MCP) 및 금지/허용

### 5.1 권한 레벨
- L0(허용): 정책 설명/절차 안내/폼 안내/티켓 생성(요청)
- L1(선택): 본인확인 후 조회(주문/배송 상태 등 읽기)
- L2(금지, MVP 밖): 환불 승인/계정 변경/결제 취소 등 실행

### 5.2 MVP 기본 정책
- MVP는 **L0 고정**
- 단정 금지 조건:
  - KB 근거 부족
  - 정책 충돌
  - 핵심 정보 누락

---

## 6. 에스컬레이션 규칙

### 6.1 하드 룰(즉시 사람/콜백)
- 법적 위협/분쟁(고소/소송/소비자원 등)
- 안전/사고/부상
- 보안/계정 해킹/정보유출
- 고액/부정결제/이중결제
- 실행 요구(환불 ‘처리’ 등)
- 욕설/격앙
- KB 근거 점수/개수 임계치 미달

### 6.2 소프트 룰(점수 누적)
- 확인 루프 2회 실패
- 예외/재량 요청(“이번만”)
- 핵심 정보 2개 이상 누락
- 동일 문의 재통화(짧은 기간 내 반복)

---

## 7. 운영자 대시보드/리포트 요구사항(상세)

### 7.1 ‘가장 많은 문의’ 파악
- Top 카테고리/Top 이슈(키워드)
- 시간대/요일별 트래픽

### 7.2 ‘AI 대체가 쉬운 문의’ 파악
- 만족도(1) 비율이 높고 에스컬레이션이 낮은 카테고리
- KB 근거가 안정적으로 매칭되는 카테고리
- 확인 루프 실패율이 낮은 카테고리

### 7.3 ‘개선해야 할 문의’ 파악
- 만족도(2) 높은 카테고리
- KB 근거 부족 빈발
- 특정 문서 버전에서 오답 급증

---

## 8. 이벤트/로그 스키마(개념)
운영자 콘솔과 분석을 위해 세션 내 이벤트를 표준화한다.

- SESSION_STARTED
- TURN_RECORDED (audio_segment_ref)
- ASR_TRANSCRIBED (transcript_text, confidence)
- SUMMARY_GENERATED (summary_text)
- CONFIRMATION_REQUESTED (confirm_prompt)
- USER_CONFIRMED (yes/no + correction_text)
- KB_RETRIEVED (doc_ids, versions, snippets)
- ANSWER_GENERATED (answer_text)
- TTS_SPOKEN (optional)
- FEEDBACK_COLLECTED (1/2)
- ESCALATED (reason, destination)
- SESSION_ENDED

---

## 9. MVP 완료(출시) 기준
- 2.1의 1~8 단계가 모든 세션에서 **누락 없이 기록**되고 콘솔에서 재생/조회 가능
- 운영자 콘솔에서:
  - 세션 로그(음성+텍스트) 조회
  - 카테고리별 문의량/만족도/에스컬레이션 통계
  - ‘대체 용이성’ 등급 설정 및 적용
  - KB 문서 등록/수정/버전 관리
- 개인정보 보호:
  - 기본 마스킹, 접근권한, 감사로그

---

## 10. 랜딩 페이지(UI/UX) 요구사항(필수)

본 MVP에는 **고객/사업체 공용 랜딩 페이지**가 포함되며, 이는 서비스의 핵심 컨셉과 사용 흐름을 명확히 전달해야 한다.

### 10.0 도메인 확정
- **공식 서비스 도메인: mejai.help**
- 페이지는 **역할(질문자/사업체 운영자)**에 따라 접근 범위를 구분한다.
  - **질문자(고객)**: 통화 중 제공되는 입력 페이지 외에는 일반적으로 접근하지 않는다.
  - **사업체(운영자)**: 랜딩/데모/가입·로그인/온보딩/관리 콘솔 전체가 필요하다.

표기 규칙:
- `mejai_UI.jsx > 컴포넌트/섹션 > Route path`

권장 URL 구조(예시):
- 마케팅/설명 영역(운영자 유입):
  - https://mejai.help (메인 랜딩)
  - https://mejai.help/demo (데모/동작 설명)
  - https://mejai.help/pricing (요금/플랜, 선택)
  - https://mejai.help/security (보안/개인정보/컴플라이언스)
  - https://mejai.help/docs (간단 문서/가이드, 선택)

- 인증/온보딩(운영자):
  - https://mejai.help/login (로그인) → `mejai_UI.jsx > PublicRoutes > <Route path="/login" />`
  - https://mejai.help/signup (가입) → `mejai_UI.jsx > PublicRoutes > <Route path="/signup" />`
  - https://mejai.help/verify (이메일/계정 검증) → `mejai_UI.jsx > PublicRoutes > <Route path="/verify" />`
  - https://mejai.help/forgot (비밀번호/로그인 복구) → `mejai_UI.jsx > PublicRoutes > <Route path="/forgot" />`
  - https://mejai.help/onboarding (사업체 생성/번호 연결/정책 업로드) → `mejai_UI.jsx > ProtectedRoutes > <Route path="/onboarding" />`

- 관리 콘솔(운영자 전용):
  - https://mejai.help/app (대시보드 홈) → `mejai_UI.jsx > AppLayout > <Route path="/app" index />`
  - https://mejai.help/app/calls (통화/세션 리스트) → `mejai_UI.jsx > AppLayout > <Route path="/app/calls" />`
  - https://mejai.help/app/calls/{session_id} (세션 상세) → `mejai_UI.jsx > AppLayout > <Route path="/app/calls/:sessionId" />`
  - https://mejai.help/app/eval (대체 용이성 평가/관리) → `mejai_UI.jsx > AppLayout > <Route path="/app/eval" />`
  - https://mejai.help/app/kb (지식 베이스) → `mejai_UI.jsx > AppLayout > <Route path="/app/kb" />`
  - https://mejai.help/app/rules (라우팅/에스컬레이션 규칙) → `mejai_UI.jsx > AppLayout > <Route path="/app/rules" />`
  - https://mejai.help/app/review (리뷰/개선 워크플로) → `mejai_UI.jsx > AppLayout > <Route path="/app/review" />`
  - https://mejai.help/app/team (팀/권한/RBAC) → `mejai_UI.jsx > AppLayout > <Route path="/app/team" />` → 내부적으로 `Settings` 컴포넌트의 `tab=team` 사용
  - https://mejai.help/app/settings (설정) → `mejai_UI.jsx > AppLayout > <Route path="/app/settings" />`
  - https://mejai.help/app/audit (감사 로그) → `mejai_UI.jsx > AppLayout > <Route path="/app/audit" />` → 내부적으로 `Settings` 컴포넌트의 `tab=audit` 사용
  - https://mejai.help/app/billing (결제/플랜) → `mejai_UI.jsx > AppLayout > <Route path="/app/billing" />`

- 통화 중 웹 입력(질문자 전용):
  - https://mejai.help/call/{token} (1회용 토큰 기반 입력 페이지)

### 10.1 UI 구현 기준(단일 소스 오브 트루스)
- 랜딩/데모/운영자 콘솔 UI는 **`mejai_UI.jsx`** 파일을 **구현 기준(단일 소스 오브 트루스)**으로 삼아 동일한 정보구조(IA), 컴포넌트 구성, 인터랙션, 타이포/스페이싱/컬러 시스템을 따른다.
- 기존에 언급된 “첨부 이미지(Apple AirPods 레퍼런스)”는 **더 이상 사용하지 않으며 무시**한다.
- PRD의 UI 문구와 `mejai_UI.jsx`가 충돌할 경우, **해당 파일의 구현/구성이 우선**한다(단, 본 PRD의 기능 요건과 보안/권한 요건은 예외 없이 준수).

### 10.2 히어로 섹션(Hero Section) 요구사항
히어로 섹션에는 반드시 아래 요소를 활용한다.

1. **3D 인터랙티브 오브젝트**
   - 아래 Spline 씬을 활용하거나 이를 기반으로 한 커스터마이징
   - URL: https://my.spline.design/nexbotrobotcharacterconcept-LSClj3GO999RxXpJAXwi3XNC/
   - 목적:
     - “AI가 전화를 받는다”는 개념을 직관적으로 전달
     - 기술 중심이 아닌 ‘친절한 AI 상담원’ 인상 제공

2. **핵심 메시지(카피)**
   - 예시 방향(문구는 추후 확정):
     - “전화를 받는 AI, 상담은 더 정확하게”
     - “유선 상담을 자동화하는 가장 현실적인 방법”
   - 한 문장 가치 제안(Value Proposition) + 보조 설명 1줄

3. **주요 CTA(Call To Action)**
   - 예: “데모 요청”, “도입 문의”, “어떻  게 동작하나요?”
   - CTA는 사업체(운영자) 관점 중심

### 10.3 랜딩/데모 페이지 구성(파일 기준)
- 섹션 구성 및 화면 흐름은 **`mejai_UI.jsx`**의 구조를 따른다.
- 실제 UI 구현시 페이지마다 코드를 분리하여 유지 보수가 용이하도록 한다.
- 단, 본 서비스 특성상 다음 콘텐츠 요소는 랜딩/데모 어딘가에 반드시 포함되어야 한다(배치/표현은 파일 구성 우선):
  1) 유선 전화 기반 “전사 → 요약 → 확인 → 답변” 플로우의 핵심 설명
  2) 통화 중 웹 입력 보조(https://mejai.help/call/{token})의 존재와 목적
  3) 운영자 콘솔에서 가능한 일: 로그/통계/평가/지식 갱신 및 ‘AI 처리 범위 확장’
  4) 녹취/텍스트 기록 및 개인정보 보호 원칙(요약)

1. **서비스 라인업/사용 시나리오 섹션**
   - 예: 일반 문의 자동 응답 / 반복 CS 처리 / 상담원 보조

2. **비교/설명 섹션**
   - 기존 유선 상담 vs AI 상담봇
   - 사람이 반드시 필요한 영역과 AI로 충분한 영역의 구분

3. **기능 하이라이트 섹션**
   - 음성 전사 → 요약 → 확인 → 답변 구조 시각화
   - 웹 입력 보조(전화번호 매칭 페이지) 설명

4. **신뢰/안정성 섹션**
   - 모든 통화 녹음 및 텍스트 기록
   - 로그/감사/운영자 콘솔 제공

5. **하단 정보 및 푸터**
   - 약관/개인정보 처리
   - 사업체 문의 채널

### 10.4 랜딩 페이지의 역할 정의
- **고객용 콜 유도 페이지가 아님**
- 목적:
  - 사업체가 ‘이 서비스로 무엇을 자동화할 수 있는지’ 이해
  - 유선 전화 특화 AI라는 차별점 강조
  - 운영자 콘솔/로그/관리 관점의 신뢰 확보

---

## 11. 기술 스택 확정 항목(필수) 및 권장안(프리필)

현재 문서는 **벤더/구현 언어/인프라를 확정하지 않은 상태**로 기능·데이터·운영 요구사항 중심으로 작성되어 있다. 아래 항목들은 구현 착수 전 확정이 필요하며, 본 섹션에 **권장 기본안(프리필)**을 함께 제시한다.

> 원칙: 소규모 스타트업 MVP 기준으로 **구현 난이도 최소화**, **운영 안정성**, **확장성(추후 교체 가능)**을 우선한다.

(중략: 기존 11.x 항목 유지)

---

## 12. Google Cloud Text-to-Speech 적용 실전 개발 순서(표준안)

본 섹션은 본 서비스에서 **Google Cloud Text-to-Speech(TTS)** 를 사용해 유선 전화에서 음성 응답을 구현하는 **권장 실전 절차**를 정의한다. 이는 MVP → 고도화 단계까지를 포괄하며, 구현 순서를 어길 경우 난이도·리스크가 급격히 증가할 수 있다.

### 12.1 아키텍처 확정: 전화 플랫폼 + TTS 결합 방식

#### 선택지 A: 외부 TTS(Google TTS) + Programmable Voice
- 대상: Twilio / Telnyx / Vonage 등 통화 제어 플랫폼
- 구조:
  - 전화 플랫폼 → 통화 이벤트(Webhook/Media Stream)
  - Orchestrator(봇 서버) → 텍스트 정본 확정
  - Google TTS → 오디오 생성
  - 전화 플랫폼 → 오디오 재생 또는 스트림 인
- 비고:
  - 음성 품질/음색 다양성 확보
  - Media Streams(WebSocket) 사용 시 난이도 높음

#### 선택지 B: 전화 플랫폼 내장 TTS 우선
- 통화 중 Speak/TTS 커맨드 제공 플랫폼 활용
- MVP 구현 속도는 빠르나 음성 다양성은 제한적
- 장기적으로는 선택지 A와 혼합되는 경우가 많음

**MVP 권장안**: 선택지 B 또는 A(파일 기반 재생) → 이후 스트리밍 고도화

---

### 12.2 Google Cloud 준비 단계(필수 선행)

> **이 단계는 개발자가 아닌 운영자도 수행할 수 있어야 한다.**
> 아래 절차는 **초등학생 비개발자도 화면을 그대로 따라 하면 완료**할 수 있는 수준을 목표로 한다.

1. 웹 브라우저에서 https://console.cloud.google.com 접속
2. 상단의 **프로젝트 선택 ▸ 새 프로젝트** 클릭
   - 프로젝트 이름 예시: `mejai-tts`
3. 좌측 메뉴에서 **결제(Billing)** 선택 후 카드 연결
4. 좌측 상단 검색창에 `Text-to-Speech` 입력
5. **Cloud Text-to-Speech API** 클릭 → **사용(Enable)** 버튼 클릭
6. 좌측 메뉴 **IAM 및 관리자 ▸ 서비스 계정** 선택
7. **서비스 계정 만들기** 클릭
   - 이름 예시: `mejai-tts-bot`
8. 생성 후 **키 ▸ 키 추가 ▸ JSON** 선택 → 파일 다운로드
9. 이 파일을 운영자 콘솔의 **설정 ▸ 외부 서비스 ▸ Google TTS** 화면에 업로드

- 이 단계에서 코드를 작성할 필요는 없다.
- “API”, “IAM” 등의 용어를 이해하지 못해도 **버튼 위치만 따라 하면 완료**되도록 설계한다.

---

### 12.3 전화 품질(8kHz) 기준의 오디오 포맷 규정(필수)
- 유선 전화 표준: **8kHz, mono**
- Google TTS 출력 권장:
  - LINEAR16(PCM) 8kHz 직접 생성 또는
  - 고품질 생성 후 8kHz 다운샘플링
- 파일 컨테이너 권장: **WAV(PCM 8kHz mono)**
- 스트리밍 시 프레임/코덱 정합 필수

---

### 12.4 구현 1단계(MVP): 파일 기반 TTS 재생

**목표**: 안정성 최우선

1. Orchestrator가 답변 텍스트 정본 확정
2. Google TTS로 문장 단위 오디오 생성
3. 오디오 파일을 서명 URL로 호스팅(단기 만료)
4. 전화 플랫폼의 Play/Speak 기능으로 통화에 재생

- 권장 분할 단위: 2~4문장 또는 10~20초
- 재생 실패 시 폴백 멘트 필수

---

### 12.5 구현 2단계: 실시간(저지연) 스트리밍 TTS 고도화

- LLM 출력 → 문장 단위 버퍼링
- Google TTS bidirectional streaming으로 오디오 청크 수신
- 전화 플랫폼(Media Streams)으로 즉시 송출

필수 고려 사항:
- 200~500ms 버퍼링
- 고객 발화(barge-in) 시 합성/재생 즉시 중단
- 중간 취소로 인한 비용 폭주 방지

---

### 12.6 ASR(음성→텍스트) 및 확인 루프 보완 규정
- 실시간 스트리밍 ASR 필수
- ASR 결과에 confidence 저장
- confidence 낮을 경우:
  - 확인 질문 강화
  - 웹 입력 페이지 안내
- 확인 루프 최대 2회 초과 시 에스컬레이션

---

### 12.7 비용 가드레일 및 캐싱 전략
- 고정 멘트(동의/확인/안내)는 사전 합성 캐시
- 답변은 짧은 문장 다중 구성 권장
- 콜당 TTS 문자 수/ASR 분량/LLM 호출 횟수 추적

---

### 12.8 개발 마일스톤(권장 순서)
1. 전화 플랫폼 연결(수신/DTMF/녹취)
2. 텍스트 정본 저장 흐름 완성(전사/요약/확인/답변)
3. Google TTS 파일 기반 재생 적용
4. 8kHz 통화 품질 최적화
5. 병목 측정 후 스트리밍 TTS 고도화

---

## 13. 권장 기본 스택(요약)
 권장 기본 스택(요약)
- Backend/Orchestrator: TypeScript(Node.js) + (HTTP/Webhook/Streaming)
- Frontend(운영자 콘솔/웹 입력): Next.js
- DB: **Supabase Postgres**
- Auth: **Supabase Auth**
- Storage(녹음/아카이브): **Supabase Storage**(또는 S3 호환)
- Cache/Sessions(선택): Redis (고트래픽/레이트리밋/세션 가속)
- Realtime(선택): Supabase Realtime (콜 중 웹 입력 동기화)
- RAG: Managed Vector DB + 문서 원천(Notion/Docs)
- Observability: 로그+메트릭+알람(Managed)

---

## 13. 추후 확장(참고)
- L1 조회 도입(본인확인/주문조회)
- 상담원 실시간 바지(whisper) 기능
- 자동 QA(샘플링 평가) 및 룰 추천
- 멀티 테넌시(여러 사업체)



## 부록 A. 프로젝트 원칙(품질/테스트/UX/성능)

본 프로젝트는 아래 원칙을 ‘비기능 요구사항(NFR)’로 고정하며, 모든 구현 단계의 완료 기준(Exit Criteria)에 포함한다.

1. 코드 품질
   - 간결하고 읽기 쉬운 코드
   - 주석은 최소화하고, 함수/타입/모듈 경계를 통해 코드가 자체 설명되도록

2. 테스트
   - 핵심 로직은 반드시 테스트 작성
   - **최소 70% 이상 커버리지 목표(라인/분기 기준)**: 코드의 70% 이상이 테스트 실행 경로에 포함되도록 유지하며, 신규·변경 코드에서 커버리지 하락을 허용하지 않는다.

3. 사용자 경험
   - 직관적이고 빠른 인터페이스
   - **3초 이내 응답 목표**(가능한 범위에서: 음성 응답은 ‘첫 응답’ 기준)

4. 성능
   - 불필요한 라이브러리 사용 최소화
   - 필수 요소를 제외하고 **최소한의 의존성**으로 구현

