디버그 대원칙:
- 본 원칙은 F_audit_mcp_tools, F_audit_events, F_audit_turn_specs 테이블에 내용을 기록할 때에 최소한의 디버깅으로 최대한의 개선을 위해 반드시 준수하여 해당 테이블에 기록하게 할 것(기록하는 기능 설계시 아래의 원칙 미준수가 감지되면 개선하여 기록하도록 할 것)
- 원인 미확인은 로그 누락/정밀도 부족에서 발생한다.
- 단계별 로그를 촘촘히 남겨 범위를 줄인다 (5->2->1 단계).
- 실패 지점의 직전/직후 로그를 반드시 기록한다.

기대 목록(MCP): solapi:send_otp, search_address, cafe24:update_order_shipping_address, solapi:verify_otp
기대 목록(Event): QUICK_REPLY_RULE_DECISION, FINAL_ANSWER_READY, POLICY_DECISION, RUNTIME_SELF_UPDATE_REVIEW_COMPLETED, RUNTIME_SELF_UPDATE_REVIEW_STARTED, END_USER_WRITE_LATENCY, END_USER_MATCH_HIT, RUNTIME_PATCH_PROPOSAL_CREATED, PRINCIPLE_VIOLATION_DETECTED, AUTH_GATE_TRIGGERED, AUTH_GATE_PRECHECK, EXECUTION_GUARD_TRIGGERED, INTENT_SCOPE_GATE_REVIEW_COMPLETED, INTENT_SCOPE_GATE_REVIEW_STARTED, SLOT_EXTRACTED, POLICY_STATIC_CONFLICT, CONTEXT_CONTAMINATION_DETECTED, INPUT_CONTRACT_REVIEW_COMPLETED, INPUT_CONTRACT_REVIEW_STARTED, ADDRESS_SEARCH_STARTED, MCP_TOOL_FAILED, POLICY_CONFLICT_DETECTED, PRE_MCP_DECISION
기대 목록(Debug): NO_TOOL_CALLED, send_otp, update_order_shipping_address

사용 모듈(Runtime): src/app/api/runtime/chat/runtime/runtimeTurnIo.ts
사용 모듈(Handlers): -
사용 모듈(Services): -
사용 모듈(Policies): -
사용 모듈(Shared): -

점검 완료 항목: mcp.solapi:send_otp, mcp.search_address, mcp.cafe24:update_order_shipping_address, mcp.solapi:verify_otp, event.QUICK_REPLY_RULE_DECISION, event.FINAL_ANSWER_READY, event.POLICY_DECISION, event.RUNTIME_SELF_UPDATE_REVIEW_COMPLETED, event.RUNTIME_SELF_UPDATE_REVIEW_STARTED, event.END_USER_WRITE_LATENCY, event.END_USER_MATCH_HIT, event.RUNTIME_PATCH_PROPOSAL_CREATED, event.PRINCIPLE_VIOLATION_DETECTED, event.AUTH_GATE_TRIGGERED, event.AUTH_GATE_PRECHECK, event.EXECUTION_GUARD_TRIGGERED, event.INTENT_SCOPE_GATE_REVIEW_COMPLETED, event.INTENT_SCOPE_GATE_REVIEW_STARTED, event.SLOT_EXTRACTED, event.POLICY_STATIC_CONFLICT, event.CONTEXT_CONTAMINATION_DETECTED, event.INPUT_CONTRACT_REVIEW_COMPLETED, event.INPUT_CONTRACT_REVIEW_STARTED, event.ADDRESS_SEARCH_STARTED, event.MCP_TOOL_FAILED, event.POLICY_CONFLICT_DETECTED, event.PRE_MCP_DECISION, debug.NO_TOOL_CALLED, debug.send_otp, debug.update_order_shipping_address, response_schema.present, response_schema.valid
점검 미완료: -
점검 불가: -


TURN_ID: de4e6275-da2d-411d-8202-bfc521b6342f

[TOKEN_USED]

USER:
배송지 변경

BOT:
원하시는 문의 유형을 선택해주세요. (번호로 답변)
- 1번 | 배송지 변경 | 배송지/수령인 정보 변경
- 2번 | 배송 문의 | 배송 상태/송장 조회
예) 1,2
RESPONSE_SCHEMA: view=choice, choice_mode=multi, quick_replies=2, cards=0
RESPONSE_SCHEMA_DETAIL:
  {
    "message": "원하시는 문의 유형을 선택해주세요. (번호로 답변)\n- 1번 | 배송지 변경 | 배송지/수령인 정보 변경\n- 2번 | 배송 문의 | 배송 상태/송장 조회\n예) 1,2",
    "ui_hints": {
      "view": "choice",
      "choice_mode": "multi"
    },
    "quick_replies": [
      {
        "label": "1",
        "value": "1"
      },
      {
        "label": "2",
        "value": "2"
      }
    ],
    "cards": []
  }
RENDER_PLAN: view=choice, quick_replies=true, cards=false, mode=multi, min=1, max=2, submit=csv, prompt=intent_disambiguation
RENDER_PLAN_DETAIL:
  {
    "view": "choice",
    "enable_quick_replies": true,
    "enable_cards": false,
    "interaction_scope": "latest_only",
    "quick_reply_source": {
      "type": "explicit",
      "criteria": "payload:quick_replies"
    },
    "selection_mode": "multi",
    "min_select": 1,
    "max_select": 2,
    "submit_format": "csv",
    "grid_columns": {
      "quick_replies": 2,
      "cards": 1
    },
    "prompt_kind": "intent_disambiguation",
    "debug": {
      "policy_version": "v1",
      "quick_replies_count": 2,
      "cards_count": 0,
      "selection_mode_source": "config",
      "min_select_source": "config",
      "max_select_source": "config",
      "submit_format_source": "config"
    }
  }
QUICK_REPLY_RULE: mode=multi, min=1, max=2, submit=csv, source=explicit, criteria=payload:quick_replies, module=-, function=-

[TOKEN_UNUSED]
DEBUG 로그:
- 77260016-d001-4ee8-9c64-defbbd9cf453 (turn_id=de4e6275-da2d-411d-8202-bfc521b6342f) (2026-02-19T05:10:53.425+00:00)
  prefix_json:
    {
      "kb": {
        "admin": [
          {
            "id": "878b3ffe-2e18-4820-bda6-ffeccaa4212b",
            "title": "커머스 공통",
            "version": "1.0",
            "is_admin": true
          },
          {
            "id": "0da02c01-aad4-4286-a445-4db7a89f8ebe",
            "title": "mk2",
            "version": "1.0",
            "is_admin": true
          }
        ],
        "primary": {
          "id": "f29567ba-275a-4cd9-add8-fa7b3d6e54c2",
          "title": "테스트",
          "version": "1.2",
          "is_admin": false
        }
      },
      "mcp": {
        "last": {
          "error": null,
          "status": "none",
          "function": "NO_TOOL_CALLED",
          "result_count": null
        }
      },
      "auth": {
        "providers": [
          "cafe24",
          "shopify",
          "chat_policy"
        ],
        "settings_id": "d8fc56a3-db28-4af2-8499-285ed7ab62a5"
      },
      "mode": "mk2",
      "slot": {
        "phone_masked": "-"
      },
      "user": {
        "id": "fa7baaa2-806f-4457-88f0-7d29f802d126",
        "plan": "pro",
        "role": "owner",
        "org_id": "8ad81b6b-3210-40dd-8e00-9a43a4395923",
        "is_admin": true
      },
      "agent": {
        "id": "339f6e47-4239-49ee-9972-a7069038fe08",
        "llm": "chatgpt",
        "name": "에이전트1",
        "kb_id": "f29567ba-275a-4cd9-add8-fa7b3d6e54c2",
        "version": "1.4",
        "parent_id": "54916862-764f-4ecc-8400-899fdb7a1fcc"
      },
      "build": {
        "ref": null,
        "tag": "debug-prefix-v3",
        "node": "v22.22.0",
        "commit": null,
        "build_at": null,
        "build_id": null,
        "deploy_env": "production",
        "runtime_started_at": "2026-02-19T05:10:06.619Z"
      },
      "widget": {
        "id": "c9ab5088-1d28-4f7f-88f4-01c46fa9ddfc",
        "name": "Web Widget",
        "org_id": "8ad81b6b-3210-40dd-8e00-9a43a4395923",
        "agent_id": "54916862-764f-4ecc-8400-899fdb7a1fcc",
        "public_key": "mw_pk_332d0d4b80aa56bc55882d0317979808",
        "allowed_domains": [
          "https://sungjy2020.cafe24.com/",
          "https://mejai.cafe24.com/"
        ]
      },
      "decision": {
        "line": 152,
        "phase": "runtime",
        "column": 0,
        "call_chain": [
          {
            "line": 152,
            "column": 0,
            "module_path": "src/app/api/runtime/chat/runtime/runtimeTurnIo.ts",
            "function_name": "insertTurnWithDebug"
          }
        ],
        "module_path": "src/app/api/runtime/chat/runtime/runtimeTurnIo.ts",
        "recorded_at": "2026-02-19T05:10:53.161Z",
        "function_name": "insertTurnWithDebug"
      },
      "kb_admin": {
        "kb_user_id": "f29567ba-275a-4cd9-add8-fa7b3d6e54c2",
        "kb_admin_ids": [
          "878b3ffe-2e18-4820-bda6-ffeccaa4212b",
          "0da02c01-aad4-4286-a445-4db7a89f8ebe"
        ]
      },
      "execution": {
        "call_chain": [
          {
            "module_path": "src/app/api/runtime/chat/runtime/runtimeOrchestrator.ts",
            "function_name": "POST"
          },
          {
            "module_path": "src/app/api/runtime/chat/runtime/runtimeBootstrap.ts",
            "function_name": "bootstrapRuntime"
          },
          {
            "module_path": "src/app/api/runtime/chat/runtime/runtimeInitializationRuntime.ts",
            "function_name": "initializeRuntimeState"
          },
          {
            "module_path": "src/app/api/runtime/chat/runtime/intentDisambiguationRuntime.ts",
            "function_name": "resolveIntentDisambiguation"
          }
        ]
      },
      "slot_flow": {
        "expected_inputs": []
      },
      "templates": {
        "override_count": 1,
        "overrides_applied": {
          "order_choice_title": "주문번호를 모르셔도 됩니다. 아래 주문(주문일시/상품명/옵션/금액) 중 해당 주문의 번호를 선택해 주세요."
        }
      },
      "request_meta": {
        "domain": "mejai.help",
        "widget_org_id_present": true,
        "widget_secret_present": true,
        "widget_user_id_present": false,
        "widget_agent_id_present": true
      },
      "kb_resolution": {
        "user_group": {
          "paid": {
            "grade": "pro"
          },
          "service": {
            "tenant": "cafe24",
            "volume": {
              "scale": "bulk",
              "performance": "high"
            }
          }
        },
        "admin_kb_apply_groups": [
          {
            "id": "878b3ffe-2e18-4820-bda6-ffeccaa4212b",
            "apply_groups": null
          },
          {
            "id": "0da02c01-aad4-4286-a445-4db7a89f8ebe",
            "apply_groups": [
              {
                "path": "paid.grade",
                "values": [
                  "pro"
                ]
              },
              {
                "path": "service.tenant",
                "values": [
                  "cafe24"
                ]
              },
              {
                "path": "service.volume.performance",
                "values": [
                  "high"
                ]
              },
              {
                "path": "service.volume.scale",
                "values": [
                  "bulk"
                ]
              }
            ]
          }
        ],
        "admin_kb_filter_reasons": [
          "agent_selected",
          "agent_selected"
        ],
        "admin_kb_apply_groups_mode": [
          "all",
          "any"
        ]
      },
      "resolved_agent": {
        "is_active": true,
        "mcp_tool_ids": [
          "c962d4b0-d96a-45f6-a985-59b8b93534c0",
          "c78fe2ef-9925-45bf-8f14-2f5954dfb00c",
          "03b67d63-e22d-4820-b101-bf545df8e78c",
          "aec3bd90-314a-4929-9fe5-6ed33888857c",
          "6780420a-3574-4a0f-97d4-5ce43e7ac21e",
          "1d09fb43-4ca8-4c4c-940f-8ac1bbb43a13",
          "0908279c-a369-4684-92ac-8a9f5af1407f",
          "bc9adf5e-e09f-4eed-9391-16aab9e3957a",
          "4b4cec22-7d1b-4c06-8579-08cdfbacc16b",
          "11025bb2-770a-4c55-af11-83ba2caabcb8",
          "56cef951-28f5-4b11-85f5-7624adc15862",
          "a9cd0a00-59f1-43fd-97d4-5f5c1bca3c07",
          "f45fa968-4bfe-4025-a74c-8f14f241bb43",
          "ffb90354-4eb0-4dd8-9ba1-d6608a1ea79b",
          "bc06a0c1-8f40-4ba8-9668-682170254b34"
        ],
        "resolved_from_parent": true
      },
      "schema_version": 3,
      "tool_allowlist": {
        "valid_tool_count": 15,
        "resolved_tool_ids": [
          "11025bb2-770a-4c55-af11-83ba2caabcb8",
          "a9cd0a00-59f1-43fd-97d4-5f5c1bca3c07",
          "bc06a0c1-8f40-4ba8-9668-682170254b34",
          "aec3bd90-314a-4929-9fe5-6ed33888857c",
          "ffb90354-4eb0-4dd8-9ba1-d6608a1ea79b",
          "4b4cec22-7d1b-4c06-8579-08cdfbacc16b",
          "56cef951-28f5-4b11-85f5-7624adc15862",
          "0908279c-a369-4684-92ac-8a9f5af1407f",
          "c962d4b0-d96a-45f6-a985-59b8b93534c0",
          "bc9adf5e-e09f-4eed-9391-16aab9e3957a",
          "c78fe2ef-9925-45bf-8f14-2f5954dfb00c",
          "03b67d63-e22d-4820-b101-bf545df8e78c",
          "6780420a-3574-4a0f-97d4-5ce43e7ac21e",
          "1d09fb43-4ca8-4c4c-940f-8ac1bbb43a13",
          "f45fa968-4bfe-4025-a74c-8f14f241bb43"
        ],
        "tools_by_id_count": 15,
        "allowed_tool_count": 15,
        "allowed_tool_names": [
          "cafe24:read_shipping",
          "cafe24:read_order_settings",
          "cafe24:create_ticket",
          "cafe24:lookup_order",
          "cafe24:track_shipment",
          "cafe24:read_product",
          "cafe24:read_supply",
          "cafe24:update_order_settings",
          "juso:search_address",
          "cafe24:api_get_customers_member_id_autoupdate_0d586802",
          "solapi:send_otp",
          "solapi:verify_otp",
          "cafe24:list_orders",
          "cafe24:update_order_shipping_address",
          "cafe24:resolve_product"
        ],
        "provider_selections": [],
        "resolved_tool_count": 15,
        "requested_tool_count": 15,
        "tools_by_provider_count": 0,
        "provider_selection_count": 0,
        "missing_tools_expected_by_intent": []
      },
      "model_resolution": {
        "input_length": 6,
        "length_rule_hit": null,
        "keyword_rule_hit": null,
        "selection_reason": "deterministic_or_skipped"
      },
      "policy_conflicts": {
        "conflicts": []
      }
    }
이벤트 로그:
- 9f76a7b7-7531-4d3d-bc0d-f4548856e9a7 QUICK_REPLY_RULE_DECISION (2026-02-19T05:10:59.596+00:00) (turn_id=de4e6275-da2d-411d-8202-bfc521b6342f)
  payload:
    {
      "quick_reply_count": 2,
      "quick_reply_config": {
        "preset": null,
        "criteria": "policy:ASK_INTENT_DISAMBIGUATION",
        "max_select": 2,
        "min_select": 1,
        "source_module": "src/app/api/runtime/chat/runtime/intentDisambiguationRuntime.ts",
        "submit_format": "csv",
        "selection_mode": "multi",
        "source_function": "resolveIntentDisambiguationQuickReplyConfig"
      },
      "quick_reply_source": {
        "criteria": "payload:quick_replies"
      }
    }
- bc53ecc2-69b7-45cb-a259-b28bd7c89749 FINAL_ANSWER_READY (2026-02-19T05:10:59.323+00:00) (turn_id=de4e6275-da2d-411d-8202-bfc521b6342f)
  payload:
    {
      "model": "deterministic_intent_disambiguation",
      "answer": "원하시는 문의 유형을 선택해주세요. (번호로 답변)\n- 1번 | 배송지 변경 | 배송지/수령인 정보 변경\n- 2번 | 배송 문의 | 배송 상태/송장 조회\n예) 1,2",
      "_decision": {
        "line": 155,
        "phase": "after",
        "column": 0,
        "call_chain": [
          {
            "line": 155,
            "column": 0,
            "module_path": "src/app/api/runtime/chat/runtime/intentDisambiguationRuntime.ts",
            "function_name": "emit:FINAL_ANSWER_READY"
          }
        ],
        "module_path": "src/app/api/runtime/chat/runtime/intentDisambiguationRuntime.ts",
        "recorded_at": "2026-02-19T05:10:59.323Z",
        "function_name": "emit:FINAL_ANSWER_READY"
      },
      "quick_reply_config": {
        "preset": null,
        "criteria": "policy:ASK_INTENT_DISAMBIGUATION",
        "max_select": 2,
        "min_select": 1,
        "source_module": "src/app/api/runtime/chat/runtime/intentDisambiguationRuntime.ts",
        "submit_format": "csv",
        "selection_mode": "multi",
        "source_function": "resolveIntentDisambiguationQuickReplyConfig"
      }
    }
- f5ce79a7-9f52-44e5-94b0-3656aca3835d POLICY_DECISION (2026-02-19T05:10:59.071+00:00) (turn_id=de4e6275-da2d-411d-8202-bfc521b6342f)
  payload:
    {
      "stage": "input",
      "action": "ASK_INTENT_DISAMBIGUATION",
      "options": [
        "order_change",
        "shipping_inquiry"
      ],
      "_decision": {
        "line": 147,
        "phase": "decision",
        "column": 0,
        "call_chain": [
          {
            "line": 147,
            "column": 0,
            "module_path": "src/app/api/runtime/chat/runtime/intentDisambiguationRuntime.ts",
            "function_name": "emit:POLICY_DECISION"
          }
        ],
        "module_path": "src/app/api/runtime/chat/runtime/intentDisambiguationRuntime.ts",
        "recorded_at": "2026-02-19T05:10:59.071Z",
        "function_name": "emit:POLICY_DECISION"
      }
    }
- 5d2f630c-37da-4be6-b511-becb2ee22ebf RUNTIME_SELF_UPDATE_REVIEW_COMPLETED (2026-02-19T05:10:58.757+00:00) (turn_id=de4e6275-da2d-411d-8202-bfc521b6342f)
  payload:
    {
      "org_id": "8ad81b6b-3210-40dd-8e00-9a43a4395923",
      "turn_id": "de4e6275-da2d-411d-8202-bfc521b6342f",
      "session_id": "b72aa142-82e3-46bb-9e9a-3bc46a783090",
      "violation_count": 0,
      "deduped_violation_count": 0
    }
- 974189b3-f2e7-4a74-b711-da5f16187d8b RUNTIME_SELF_UPDATE_REVIEW_STARTED (2026-02-19T05:10:58.205+00:00) (turn_id=de4e6275-da2d-411d-8202-bfc521b6342f)
  payload:
    {
      "org_id": "8ad81b6b-3210-40dd-8e00-9a43a4395923",
      "turn_id": "de4e6275-da2d-411d-8202-bfc521b6342f",
      "session_id": "b72aa142-82e3-46bb-9e9a-3bc46a783090",
      "config_source": "principles_default"
    }
- d0039993-f7dc-40a3-bca5-77a254588451 END_USER_WRITE_LATENCY (2026-02-19T05:10:57.153+00:00) (turn_id=de4e6275-da2d-411d-8202-bfc521b6342f)
  payload:
    {
      "duration_ms": 3439
    }
- eb70d7bf-c2d8-48ba-a7ed-fa17adc4c2a1 END_USER_MATCH_HIT (2026-02-19T05:10:54.487+00:00) (turn_id=de4e6275-da2d-411d-8202-bfc521b6342f)
  payload:
    {
      "matched": true,
      "identity_count": 1,
      "identity_types": [
        "external"
      ]
    }


TURN_ID: 450d1b8b-49f2-44e4-a989-d52e551df598

[TOKEN_USED]

USER:
배송지 변경

BOT:
원하시는 문의 유형을 선택해주세요. (번호로 답변)
- 1번 | 배송지 변경 | 배송지/수령인 정보 변경
- 2번 | 배송 문의 | 배송 상태/송장 조회
예) 1,2
RESPONSE_SCHEMA: view=choice, choice_mode=multi, quick_replies=2, cards=0
RESPONSE_SCHEMA_DETAIL:
  {
    "message": "원하시는 문의 유형을 선택해주세요. (번호로 답변)\n- 1번 | 배송지 변경 | 배송지/수령인 정보 변경\n- 2번 | 배송 문의 | 배송 상태/송장 조회\n예) 1,2",
    "ui_hints": {
      "view": "choice",
      "choice_mode": "multi"
    },
    "quick_replies": [
      {
        "label": "1",
        "value": "1"
      },
      {
        "label": "2",
        "value": "2"
      }
    ],
    "cards": []
  }
RENDER_PLAN: view=choice, quick_replies=true, cards=false, mode=multi, min=1, max=2, submit=csv, prompt=intent_disambiguation
RENDER_PLAN_DETAIL:
  {
    "view": "choice",
    "enable_quick_replies": true,
    "enable_cards": false,
    "interaction_scope": "latest_only",
    "quick_reply_source": {
      "type": "explicit",
      "criteria": "payload:quick_replies"
    },
    "selection_mode": "multi",
    "min_select": 1,
    "max_select": 2,
    "submit_format": "csv",
    "grid_columns": {
      "quick_replies": 2,
      "cards": 1
    },
    "prompt_kind": "intent_disambiguation",
    "debug": {
      "policy_version": "v1",
      "quick_replies_count": 2,
      "cards_count": 0,
      "selection_mode_source": "config",
      "min_select_source": "config",
      "max_select_source": "config",
      "submit_format_source": "config"
    }
  }
QUICK_REPLY_RULE: mode=multi, min=1, max=2, submit=csv, source=explicit, criteria=payload:quick_replies, module=-, function=-

[TOKEN_UNUSED]
DEBUG 로그:
- cc2f34ab-6c78-4c47-a69b-d0a61175bb77 (turn_id=450d1b8b-49f2-44e4-a989-d52e551df598) (2026-02-19T05:11:32.023+00:00)
  prefix_json:
    {
      "mcp": {
        "last": {
          "error": null,
          "status": "none",
          "function": "NO_TOOL_CALLED",
          "result_count": null
        }
      },
      "slot": {
        "phone_masked": "-",
        "expected_input": "address"
      },
      "decision": {
        "line": 152,
        "phase": "runtime",
        "column": 0,
        "call_chain": [
          {
            "line": 152,
            "column": 0,
            "module_path": "src/app/api/runtime/chat/runtime/runtimeTurnIo.ts",
            "function_name": "insertTurnWithDebug"
          }
        ],
        "module_path": "src/app/api/runtime/chat/runtime/runtimeTurnIo.ts",
        "recorded_at": "2026-02-19T05:11:31.752Z",
        "function_name": "insertTurnWithDebug"
      },
      "kb_admin": {
        "kb_user_id": "f29567ba-275a-4cd9-add8-fa7b3d6e54c2",
        "kb_admin_ids": [
          "878b3ffe-2e18-4820-bda6-ffeccaa4212b",
          "0da02c01-aad4-4286-a445-4db7a89f8ebe"
        ]
      },
      "execution": {
        "call_chain": [
          {
            "module_path": "src/app/api/runtime/chat/runtime/runtimeOrchestrator.ts",
            "function_name": "POST"
          },
          {
            "module_path": "src/app/api/runtime/chat/runtime/runtimeBootstrap.ts",
            "function_name": "bootstrapRuntime"
          },
          {
            "module_path": "src/app/api/runtime/chat/runtime/runtimeInitializationRuntime.ts",
            "function_name": "initializeRuntimeState"
          },
          {
            "module_path": "src/app/api/runtime/chat/runtime/intentDisambiguationRuntime.ts",
            "function_name": "resolveIntentDisambiguation"
          }
        ]
      },
      "slot_flow": {
        "expected_inputs": [
          "address"
        ],
        "expected_input_source": "derived_from_last_answer"
      },
      "tool_allowlist": {
        "valid_tool_count": 15,
        "resolved_tool_ids": [
          "11025bb2-770a-4c55-af11-83ba2caabcb8",
          "a9cd0a00-59f1-43fd-97d4-5f5c1bca3c07",
          "bc06a0c1-8f40-4ba8-9668-682170254b34",
          "aec3bd90-314a-4929-9fe5-6ed33888857c",
          "ffb90354-4eb0-4dd8-9ba1-d6608a1ea79b",
          "4b4cec22-7d1b-4c06-8579-08cdfbacc16b",
          "56cef951-28f5-4b11-85f5-7624adc15862",
          "0908279c-a369-4684-92ac-8a9f5af1407f",
          "c962d4b0-d96a-45f6-a985-59b8b93534c0",
          "bc9adf5e-e09f-4eed-9391-16aab9e3957a",
          "c78fe2ef-9925-45bf-8f14-2f5954dfb00c",
          "03b67d63-e22d-4820-b101-bf545df8e78c",
          "6780420a-3574-4a0f-97d4-5ce43e7ac21e",
          "1d09fb43-4ca8-4c4c-940f-8ac1bbb43a13",
          "f45fa968-4bfe-4025-a74c-8f14f241bb43"
        ],
        "tools_by_id_count": 15,
        "allowed_tool_count": 15,
        "allowed_tool_names": [
          "cafe24:read_shipping",
          "cafe24:read_order_settings",
          "cafe24:create_ticket",
          "cafe24:lookup_order",
          "cafe24:track_shipment",
          "cafe24:read_product",
          "cafe24:read_supply",
          "cafe24:update_order_settings",
          "juso:search_address",
          "cafe24:api_get_customers_member_id_autoupdate_0d586802",
          "solapi:send_otp",
          "solapi:verify_otp",
          "cafe24:list_orders",
          "cafe24:update_order_shipping_address",
          "cafe24:resolve_product"
        ],
        "provider_selections": [],
        "resolved_tool_count": 15,
        "requested_tool_count": 15,
        "tools_by_provider_count": 0,
        "provider_selection_count": 0,
        "missing_tools_expected_by_intent": []
      },
      "model_resolution": {
        "input_length": 6,
        "length_rule_hit": null,
        "keyword_rule_hit": null,
        "selection_reason": "deterministic_or_skipped"
      },
      "policy_conflicts": {
        "conflicts": []
      }
    }
이벤트 로그:
- 6cbaf397-dfe1-4067-b5db-c4626cb312d5 QUICK_REPLY_RULE_DECISION (2026-02-19T05:11:42.264+00:00) (turn_id=450d1b8b-49f2-44e4-a989-d52e551df598)
  payload:
    {
      "quick_reply_count": 2,
      "quick_reply_config": {
        "preset": null,
        "criteria": "policy:ASK_INTENT_DISAMBIGUATION",
        "max_select": 2,
        "min_select": 1,
        "source_module": "src/app/api/runtime/chat/runtime/intentDisambiguationRuntime.ts",
        "submit_format": "csv",
        "selection_mode": "multi",
        "source_function": "resolveIntentDisambiguationQuickReplyConfig"
      },
      "quick_reply_source": {
        "criteria": "payload:quick_replies"
      }
    }
- f9c9d5dc-2c81-4ea8-affd-c2d8d0cb79da RUNTIME_SELF_UPDATE_REVIEW_COMPLETED (2026-02-19T05:11:42.002+00:00) (turn_id=450d1b8b-49f2-44e4-a989-d52e551df598)
  payload:
    {
      "org_id": "8ad81b6b-3210-40dd-8e00-9a43a4395923",
      "turn_id": "450d1b8b-49f2-44e4-a989-d52e551df598",
      "session_id": "b72aa142-82e3-46bb-9e9a-3bc46a783090",
      "proposal_count": 1,
      "violation_count": 1,
      "deduped_violation_count": 0
    }
- 299312e5-a7b6-4566-adcc-d90c0b90957a RUNTIME_PATCH_PROPOSAL_CREATED (2026-02-19T05:11:41.721+00:00) (turn_id=450d1b8b-49f2-44e4-a989-d52e551df598)
  payload:
    {
      "title": "Principle violation patch proposal",
      "org_id": "8ad81b6b-3210-40dd-8e00-9a43a4395923",
      "status": "pending",
      "trigger": "runtime_turn_write",
      "turn_id": "450d1b8b-49f2-44e4-a989-d52e551df598",
      "rationale": "Prefer runtime decision-path fix over principle text changes (force_template_misapplied=false, expected_input=-, policy_reason=-)",
      "confidence": 0.7,
      "created_at": "2026-02-19T05:11:41.448Z",
      "session_id": "b72aa142-82e3-46bb-9e9a-3bc46a783090",
      "why_failed": "Address slot was already resolved, but final response selection re-asked address.",
      "change_plan": [
        "At final response stage, if expected_input=address and resolved address exists, forbid address prompt template.",
        "If policy decision is DEFER_FORCE_RESPONSE_TEMPLATE with ORDER_AND_ADDRESS_ALREADY_AVAILABLE, preserve decision through finalization.",
        "Emit explicit debug evidence (resolved_address / policy_decision_reason / final_template) around failure boundary."
      ],
      "proposal_id": "rp_1771477897302_k9u1a5",
      "target_files": [
        "src/app/api/runtime/chat/runtime/finalizeRuntime.ts",
        "src/app/api/runtime/chat/handlers/restockHandler.ts",
        "src/app/api/runtime/chat/runtime/runtimeInputStageRuntime.ts"
      ],
      "violation_id": "pv_b72aa142-82e3-46bb-9e9a-3bc46a783090_450d1b8b-49f2-44e4-a989-d52e551df598_duplicate_answer",
      "principle_key": "memory.enforceNoRepeatQuestions",
      "runtime_scope": "chat",
      "how_to_improve": "Use finalized slot/policy decision evidence to block address re-ask in final response path; add guard in runtime finalize/handler path.",
      "self_heal_gate": {
        "track": "contract",
        "gate_version": "v1",
        "exception_stats": {
          "repeat_count_7d": 2,
          "repeat_count_30d": 2
        },
        "promotion_reason": "-",
        "contract_fields_ok": false,
        "promotion_required": false,
        "exception_fields_ok": false,
        "evidence_contract_ok": false,
        "case_specific_signals": [],
        "exception_fingerprint": "ex:memory.enforcenorepeatquestions:duplicate_answer:-:-",
        "missing_contract_fields": [
          "contract_scope",
          "generalization_scope",
          "slot_request_mapping_strategy",
          "response_projection_strategy",
          "pre_post_invariant_strategy",
          "contract_expectation"
        ],
        "missing_evidence_fields": [
          "known_address_count",
          "user_provided_address_count",
          "slot_resolved_address",
          "policy_decision_reason",
          "final_response_forced_template_applied"
        ],
        "missing_exception_fields": [
          "exception_reason",
          "exception_scope",
          "exception_expiry",
          "promotion_plan",
          "promotion_trigger",
          "blast_radius"
        ]
      },
      "suggested_diff": null,
      "issue_fingerprint": "memory.enforcenorepeatquestions|chat|원하시는 문의 유형을 선택해주세요. (번호로 답변) - 1번 | 배송지 변경 | 배송지/수령인 정보 변경 - 2번 | 배송 문의 | 배송 상태/송장 조회 예) 1,2|bot repeated the same final answer on consecutive turns.|true|||"
    }
- 1a08e3ec-7420-43c0-b9d8-389f6671ac1c PRINCIPLE_VIOLATION_DETECTED (2026-02-19T05:11:41.449+00:00) (turn_id=450d1b8b-49f2-44e4-a989-d52e551df598)
  payload:
    {
      "org_id": "8ad81b6b-3210-40dd-8e00-9a43a4395923",
      "summary": "Bot repeated the same final answer on consecutive turns.",
      "trigger": "runtime_turn_write",
      "evidence": {
        "previous_answer": "원하시는 문의 유형을 선택해주세요. (번호로 답변) - 1번 | 배송지 변경 | 배송지/수령인 정보 변경 - 2번 | 배송 문의 | 배송 상태/송장 조회 예) 1,2",
        "repeated_answer": "원하시는 문의 유형을 선택해주세요. (번호로 답변) - 1번 | 배송지 변경 | 배송지/수령인 정보 변경 - 2번 | 배송 문의 | 배송 상태/송장 조회 예) 1,2",
        "previous_turn_id": "de4e6275-da2d-411d-8202-bfc521b6342f",
        "current_user_text": "배송지 변경",
        "asking_address_again": true,
        "address_like_user_input": false
      },
      "severity": "medium",
      "violation_id": "pv_b72aa142-82e3-46bb-9e9a-3bc46a783090_450d1b8b-49f2-44e4-a989-d52e551df598_duplicate_answer",
      "principle_key": "memory.enforceNoRepeatQuestions",
      "runtime_scope": "chat",
      "baseline_source": "src/app/api/runtime/chat/policies/principles.ts",
      "issue_fingerprint": "memory.enforcenorepeatquestions|chat|원하시는 문의 유형을 선택해주세요. (번호로 답변) - 1번 | 배송지 변경 | 배송지/수령인 정보 변경 - 2번 | 배송 문의 | 배송 상태/송장 조회 예) 1,2|bot repeated the same final answer on consecutive turns.|true|||"
    }
- 99d05b92-0ee4-460c-bbe4-97170cf9fa42 RUNTIME_SELF_UPDATE_REVIEW_STARTED (2026-02-19T05:11:36.334+00:00) (turn_id=450d1b8b-49f2-44e4-a989-d52e551df598)
  payload:
    {
      "org_id": "8ad81b6b-3210-40dd-8e00-9a43a4395923",
      "turn_id": "450d1b8b-49f2-44e4-a989-d52e551df598",
      "session_id": "b72aa142-82e3-46bb-9e9a-3bc46a783090",
      "config_source": "principles_default"
    }
- 9267f3ed-b642-41f9-b31a-0867641bb88b END_USER_WRITE_LATENCY (2026-02-19T05:11:35.278+00:00) (turn_id=450d1b8b-49f2-44e4-a989-d52e551df598)
  payload:
    {
      "duration_ms": 2970
    }


TURN_ID: c7277c87-bf92-4c6e-bcde-2f4e7c197acd

[TOKEN_USED]

USER:
1

BOT:
문자로 전송된 인증번호를 입력해주세요.
RESPONSE_SCHEMA: view=text, choice_mode=single, quick_replies=0, cards=0
RESPONSE_SCHEMA_DETAIL:
  {
    "message": "문자로 전송된 인증번호를 입력해주세요.",
    "ui_hints": {
      "view": "text",
      "choice_mode": "single"
    },
    "quick_replies": [],
    "cards": []
  }
RENDER_PLAN: view=text, quick_replies=false, cards=false, mode=single, min=1, max=1, submit=single, prompt=-
RENDER_PLAN_DETAIL:
  {
    "view": "text",
    "enable_quick_replies": false,
    "enable_cards": false,
    "interaction_scope": "latest_only",
    "quick_reply_source": {
      "type": "none"
    },
    "selection_mode": "single",
    "min_select": 1,
    "max_select": 1,
    "submit_format": "single",
    "grid_columns": {
      "quick_replies": 1,
      "cards": 1
    },
    "prompt_kind": null,
    "debug": {
      "policy_version": "v1",
      "quick_replies_count": 0,
      "cards_count": 0,
      "selection_mode_source": "default",
      "min_select_source": "default",
      "max_select_source": "default",
      "submit_format_source": "default"
    }
  }
QUICK_REPLY_RULE: mode=single, min=1, max=1, submit=single, source=none, criteria=-, module=-, function=-

[TOKEN_UNUSED]
DEBUG 로그:
- 33b77667-c19c-421a-998e-6b7145841a44 (turn_id=c7277c87-bf92-4c6e-bcde-2f4e7c197acd) (2026-02-19T05:13:54.415+00:00)
  prefix_json:
    {
      "mcp": {
        "last": {
          "error": null,
          "status": "success",
          "function": "send_otp",
          "result_count": 6
        }
      },
      "slot": {
        "phone": "01093107159",
        "address": "1",
        "zipcode": "08793",
        "phone_masked": "*******7159",
        "expected_input": "address"
      },
      "context": {
        "contamination": [
          "order_id | ORDER_ID_CARRYOVER_BLOCKED_BY_EXPECTED_INPUTS | CLEARED | candidate=20260127-0000014"
        ],
        "contamination_count": 1
      },
      "decision": {
        "line": 152,
        "phase": "runtime",
        "column": 0,
        "call_chain": [
          {
            "line": 152,
            "column": 0,
            "module_path": "src/app/api/runtime/chat/runtime/runtimeTurnIo.ts",
            "function_name": "insertTurnWithDebug"
          }
        ],
        "module_path": "src/app/api/runtime/chat/runtime/runtimeTurnIo.ts",
        "recorded_at": "2026-02-19T05:13:54.148Z",
        "function_name": "insertTurnWithDebug"
      },
      "kb_admin": {
        "rule_ids": [
          "R270_order_change_allow_write",
          "R275_order_change_list_orders_by_phone"
        ],
        "kb_user_id": "f29567ba-275a-4cd9-add8-fa7b3d6e54c2",
        "kb_admin_ids": [
          "878b3ffe-2e18-4820-bda6-ffeccaa4212b",
          "0da02c01-aad4-4286-a445-4db7a89f8ebe"
        ],
        "tool_policies": [
          "list_orders"
        ]
      },
      "execution": {
        "call_chain": [
          {
            "module_path": "src/app/api/runtime/chat/runtime/runtimeOrchestrator.ts",
            "function_name": "POST"
          },
          {
            "module_path": "src/app/api/runtime/chat/runtime/runtimeBootstrap.ts",
            "function_name": "bootstrapRuntime"
          },
          {
            "module_path": "src/app/api/runtime/chat/runtime/runtimeInitializationRuntime.ts",
            "function_name": "initializeRuntimeState"
          },
          {
            "module_path": "src/app/api/runtime/chat/runtime/intentDisambiguationRuntime.ts",
            "function_name": "resolveIntentDisambiguation"
          },
          {
            "module_path": "src/app/api/runtime/chat/runtime/preTurnGuardRuntime.ts",
            "function_name": "handlePreTurnGuards"
          },
          {
            "module_path": "src/app/api/runtime/chat/runtime/slotDerivationRuntime.ts",
            "function_name": "deriveSlotsForTurn"
          },
          {
            "module_path": "src/app/api/runtime/chat/runtime/pendingStateRuntime.ts",
            "function_name": "handleAddressChangeRefundPending"
          },
          {
            "module_path": "src/app/api/runtime/chat/runtime/restockPendingRuntime.ts",
            "function_name": "handleRestockPendingStage"
          },
          {
            "module_path": "src/app/api/runtime/chat/runtime/postActionRuntime.ts",
            "function_name": "handlePostActionStage"
          },
          {
            "module_path": "src/app/api/runtime/chat/runtime/contextResolutionRuntime.ts",
            "function_name": "resolveIntentAndPolicyContext"
          },
          {
            "module_path": "src/app/api/runtime/chat/runtime/runtimeInputStageRuntime.ts",
            "function_name": "runInputStageRuntime"
          },
          {
            "module_path": "src/app/api/runtime/chat/runtime/runtimeMcpOpsRuntime.ts",
            "function_name": "createRuntimeMcpOps"
          },
          {
            "module_path": "src/app/api/runtime/chat/runtime/otpRuntime.ts",
            "function_name": "handleOtpLifecycleAndOrderGate"
          },
          {
            "module_path": "src/app/api/runtime/chat/services/dataAccess.ts",
            "function_name": "resolveProductDecision"
          },
          {
            "module_path": "src/app/api/runtime/chat/runtime/toolStagePipelineRuntime.ts",
            "function_name": "runToolStagePipeline"
          }
        ]
      },
      "slot_flow": {
        "derived_address": "1",
        "expected_inputs": [
          "address"
        ],
        "expected_input_stage": "legacy.expected_input",
        "expected_input_source": "derived_from_last_answer"
      },
      "tool_allowlist": {
        "valid_tool_count": 15,
        "resolved_tool_ids": [
          "11025bb2-770a-4c55-af11-83ba2caabcb8",
          "a9cd0a00-59f1-43fd-97d4-5f5c1bca3c07",
          "bc06a0c1-8f40-4ba8-9668-682170254b34",
          "aec3bd90-314a-4929-9fe5-6ed33888857c",
          "ffb90354-4eb0-4dd8-9ba1-d6608a1ea79b",
          "4b4cec22-7d1b-4c06-8579-08cdfbacc16b",
          "56cef951-28f5-4b11-85f5-7624adc15862",
          "0908279c-a369-4684-92ac-8a9f5af1407f",
          "c962d4b0-d96a-45f6-a985-59b8b93534c0",
          "bc9adf5e-e09f-4eed-9391-16aab9e3957a",
          "c78fe2ef-9925-45bf-8f14-2f5954dfb00c",
          "03b67d63-e22d-4820-b101-bf545df8e78c",
          "6780420a-3574-4a0f-97d4-5ce43e7ac21e",
          "1d09fb43-4ca8-4c4c-940f-8ac1bbb43a13",
          "f45fa968-4bfe-4025-a74c-8f14f241bb43"
        ],
        "tools_by_id_count": 15,
        "allowed_tool_count": 15,
        "allowed_tool_names": [
          "cafe24:read_shipping",
          "cafe24:read_order_settings",
          "cafe24:create_ticket",
          "cafe24:lookup_order",
          "cafe24:track_shipment",
          "cafe24:read_product",
          "cafe24:read_supply",
          "cafe24:update_order_settings",
          "juso:search_address",
          "cafe24:api_get_customers_member_id_autoupdate_0d586802",
          "solapi:send_otp",
          "solapi:verify_otp",
          "cafe24:list_orders",
          "cafe24:update_order_shipping_address",
          "cafe24:resolve_product"
        ],
        "provider_selections": [],
        "resolved_tool_count": 15,
        "requested_tool_count": 15,
        "tools_by_provider_count": 0,
        "provider_selection_count": 0,
        "missing_tools_expected_by_intent": [
          "find_customer_by_phone"
        ]
      },
      "model_resolution": {
        "input_length": 1,
        "length_rule_hit": null,
        "keyword_rule_hit": null,
        "selection_reason": "deterministic_or_skipped"
      },
      "policy_conflicts": {
        "conflicts": [
          {
            "kind": "FORCE_RESPONSE_VS_FORCE_TOOL",
            "ruleA": "R268_order_change_need_zipcode_tool",
            "ruleB": "R271_order_change_force_update",
            "stage": "tool",
            "intentScope": "order_change"
          }
        ],
        "resolution": "tool_stage_force_response_precedence"
      }
    }
MCP 로그:
- 65a21d1c-0183-4969-945c-54af73d73b82 solapi:send_otp@1.0: success (2026-02-19T05:13:53.604+00:00) (turn_id=c7277c87-bf92-4c6e-bcde-2f4e7c197acd)
  request:
    {
      "path": "/messages/v4/send-many/detail",
      "method": "POST",
      "destination": "01093107159",
      "required_scope": "messaging.write"
    }
  response:
    {
      "otp_ref": "0e453347-2954-45df-9db9-c7c41f59f7a2",
      "delivery": "sms",
      "test_code": "101010",
      "test_mode": true,
      "expires_at": "2026-02-19T05:18:53.079Z",
      "destination": "01***59"
    }
이벤트 로그:
- 8536809b-a374-4eb9-9113-19efbef404f1 RUNTIME_SELF_UPDATE_REVIEW_COMPLETED (2026-02-19T05:14:00.811+00:00) (turn_id=c7277c87-bf92-4c6e-bcde-2f4e7c197acd)
  payload:
    {
      "org_id": "8ad81b6b-3210-40dd-8e00-9a43a4395923",
      "turn_id": "c7277c87-bf92-4c6e-bcde-2f4e7c197acd",
      "session_id": "b72aa142-82e3-46bb-9e9a-3bc46a783090",
      "violation_count": 0,
      "deduped_violation_count": 0
    }
- fc4435d4-b4b6-40fb-9a01-a2ba880394e9 RUNTIME_SELF_UPDATE_REVIEW_STARTED (2026-02-19T05:14:00.259+00:00) (turn_id=c7277c87-bf92-4c6e-bcde-2f4e7c197acd)
  payload:
    {
      "org_id": "8ad81b6b-3210-40dd-8e00-9a43a4395923",
      "turn_id": "c7277c87-bf92-4c6e-bcde-2f4e7c197acd",
      "session_id": "b72aa142-82e3-46bb-9e9a-3bc46a783090",
      "config_source": "principles_default"
    }
- c22b5d4d-47c6-4384-bf1e-e86fa4d94d20 END_USER_WRITE_LATENCY (2026-02-19T05:13:59.203+00:00) (turn_id=c7277c87-bf92-4c6e-bcde-2f4e7c197acd)
  payload:
    {
      "duration_ms": 4508
    }
- 96807d34-bdb6-43ea-9d12-4fc3f172572a AUTH_GATE_TRIGGERED (2026-02-19T05:13:53.885+00:00) (turn_id=c7277c87-bf92-4c6e-bcde-2f4e7c197acd)
  payload:
    {
      "action": "ASK_OTP_CODE",
      "intent": "order_change",
      "reason": "OTP_SENT",
      "_decision": {
        "phase": "runtime",
        "call_chain": [],
        "module_path": "unknown",
        "recorded_at": "2026-02-19T05:13:53.885Z",
        "function_name": "unknown"
      },
      "force_otp_gate": true,
      "has_sensitive_planned_call": true
    }
- b33f0562-32f4-44b0-8a58-2d1df2ce339d AUTH_GATE_PRECHECK (2026-02-19T05:13:51.738+00:00) (turn_id=c7277c87-bf92-4c6e-bcde-2f4e7c197acd)
  payload:
    {
      "intent": "order_change",
      "_decision": {
        "phase": "runtime",
        "call_chain": [],
        "module_path": "unknown",
        "recorded_at": "2026-02-19T05:13:51.738Z",
        "function_name": "unknown"
      },
      "otp_pending": false,
      "otp_verified": false,
      "planned_calls": [
        "list_orders"
      ],
      "force_otp_gate": true,
      "allowed_tool_names_count": 15,
      "has_sensitive_planned_call": true,
      "customer_verification_token_present": false
    }
- b0f97f76-9a65-4137-a7ad-8a4bb03e77d3 EXECUTION_GUARD_TRIGGERED (2026-02-19T05:13:51.469+00:00) (turn_id=c7277c87-bf92-4c6e-bcde-2f4e7c197acd)
  payload:
    {
      "tool": "update_order_shipping_address",
      "error": "MUTATION_INTENT_NOT_READY",
      "reason": "MISSING_REQUIRED_SLOTS",
      "missing": {
        "address": false,
        "zipcode": false,
        "order_id": true
      },
      "_decision": {
        "line": 125,
        "phase": "runtime",
        "column": 0,
        "call_chain": [
          {
            "line": 125,
            "column": 0,
            "module_path": "src/app/api/runtime/chat/handlers/orderChangeHandler.ts",
            "function_name": "emit:EXECUTION_GUARD_TRIGGERED"
          }
        ],
        "module_path": "src/app/api/runtime/chat/handlers/orderChangeHandler.ts",
        "recorded_at": "2026-02-19T05:13:51.469Z",
        "function_name": "emit:EXECUTION_GUARD_TRIGGERED"
      }
    }
- 9e3ed83c-48b9-4d70-890b-5e8c80691669 INTENT_SCOPE_GATE_REVIEW_COMPLETED (2026-02-19T05:13:50.934+00:00) (turn_id=c7277c87-bf92-4c6e-bcde-2f4e7c197acd)
  payload:
    {
      "intent": "order_change",
      "blocked": false,
      "_decision": {
        "phase": "runtime",
        "call_chain": [],
        "module_path": "unknown",
        "recorded_at": "2026-02-19T05:13:50.934Z",
        "function_name": "unknown"
      },
      "missing_slots": [],
      "required_slots": [],
      "resolved_slots": {}
    }
- a4cc5a35-c44e-4d44-882d-286aaa9f2c84 INTENT_SCOPE_GATE_REVIEW_STARTED (2026-02-19T05:13:50.664+00:00) (turn_id=c7277c87-bf92-4c6e-bcde-2f4e7c197acd)
  payload:
    {
      "intent": "order_change",
      "_decision": {
        "phase": "runtime",
        "call_chain": [],
        "module_path": "unknown",
        "recorded_at": "2026-02-19T05:13:50.664Z",
        "function_name": "unknown"
      },
      "query_source": "intent_disambiguation_source_text",
      "expected_input": "address"
    }
- c52f25d2-10aa-4224-be7f-f047e0dc9666 SLOT_EXTRACTED (2026-02-19T05:13:50.39+00:00) (turn_id=c7277c87-bf92-4c6e-bcde-2f4e7c197acd)
  payload:
    {
      "derived": {
        "phone": null,
        "address": "1",
        "zipcode": null,
        "order_id": null,
        "phone_masked": "-"
      },
      "resolved": {
        "phone": "01093107159",
        "intent": "order_change",
        "address": "1",
        "zipcode": "08793",
        "order_id": null,
        "phone_masked": "*******7159"
      },
      "_decision": {
        "line": 145,
        "phase": "runtime",
        "column": 0,
        "call_chain": [
          {
            "line": 145,
            "column": 0,
            "module_path": "src/app/api/runtime/chat/runtime/runtimeInputStageRuntime.ts",
            "function_name": "emit:SLOT_EXTRACTED"
          }
        ],
        "module_path": "src/app/api/runtime/chat/runtime/runtimeInputStageRuntime.ts",
        "recorded_at": "2026-02-19T05:13:50.390Z",
        "function_name": "emit:SLOT_EXTRACTED"
      },
      "query_source": "intent_disambiguation_source_text",
      "missing_slots": [],
      "expected_input": "address",
      "resolved_slots": {}
    }
- 25f5f767-aede-4040-9400-e0a830e9475c POLICY_STATIC_CONFLICT (2026-02-19T05:13:50.121+00:00) (turn_id=c7277c87-bf92-4c6e-bcde-2f4e7c197acd)
  payload:
    {
      "intent": "order_change",
      "_decision": {
        "line": 42,
        "phase": "runtime",
        "column": 0,
        "call_chain": [
          {
            "line": 42,
            "column": 0,
            "module_path": "src/app/api/runtime/chat/runtime/policyInputRuntime.ts",
            "function_name": "emit:POLICY_STATIC_CONFLICT"
          }
        ],
        "module_path": "src/app/api/runtime/chat/runtime/policyInputRuntime.ts",
        "recorded_at": "2026-02-19T05:13:50.121Z",
        "function_name": "emit:POLICY_STATIC_CONFLICT"
      },
      "conflicts": [
        {
          "kind": "FORCE_RESPONSE_VS_FORCE_TOOL",
          "ruleA": "R268_order_change_need_zipcode_tool",
          "ruleB": "R271_order_change_force_update",
          "stage": "tool",
          "intentScope": "order_change"
        }
      ],
      "resolution": "tool_stage_force_response_precedence"
    }
- db091a8c-bb77-4e61-904e-cd0f525b2576 CONTEXT_CONTAMINATION_DETECTED (2026-02-19T05:13:49.85+00:00) (turn_id=c7277c87-bf92-4c6e-bcde-2f4e7c197acd)
  payload:
    {
      "slot": "order_id",
      "action": "CLEARED",
      "reason": "ORDER_ID_CARRYOVER_BLOCKED_BY_EXPECTED_INPUTS",
      "_decision": {
        "phase": "runtime",
        "call_chain": [],
        "module_path": "unknown",
        "recorded_at": "2026-02-19T05:13:49.850Z",
        "function_name": "unknown"
      },
      "candidate": "20260127-0000014",
      "expected_inputs": [
        "address"
      ]
    }
- ee7cb4a3-f04e-46fd-9a5b-d51890c51184 INPUT_CONTRACT_REVIEW_COMPLETED (2026-02-19T05:13:49.588+00:00) (turn_id=c7277c87-bf92-4c6e-bcde-2f4e7c197acd)
  payload:
    {
      "source": "derived_from_last_answer",
      "_decision": {
        "phase": "runtime",
        "call_chain": [],
        "module_path": "unknown",
        "recorded_at": "2026-02-19T05:13:49.588Z",
        "function_name": "unknown"
      },
      "intent_name": "general",
      "expected_input": "address",
      "expected_inputs": [
        "address"
      ],
      "expected_input_stage": "legacy.expected_input"
    }
- 49c7a406-eef8-48b4-94cb-32fdd51ba9ac INPUT_CONTRACT_REVIEW_STARTED (2026-02-19T05:13:49.331+00:00) (turn_id=c7277c87-bf92-4c6e-bcde-2f4e7c197acd)
  payload:
    {
      "source": null,
      "_decision": {
        "phase": "runtime",
        "call_chain": [],
        "module_path": "unknown",
        "recorded_at": "2026-02-19T05:13:49.331Z",
        "function_name": "unknown"
      },
      "intent_name": "general",
      "expected_input": null,
      "expected_inputs": [],
      "expected_input_stage": null
    }
- 3ad0a097-469c-467e-a315-8b480f43e054 POLICY_DECISION (2026-02-19T05:13:49.065+00:00) (turn_id=c7277c87-bf92-4c6e-bcde-2f4e7c197acd)
  payload:
    {
      "stage": "input",
      "action": "INTENT_DISAMBIGUATION_SELECTED",
      "_decision": {
        "line": 175,
        "phase": "decision",
        "column": 0,
        "call_chain": [
          {
            "line": 175,
            "column": 0,
            "module_path": "src/app/api/runtime/chat/runtime/intentDisambiguationRuntime.ts",
            "function_name": "emit:POLICY_DECISION"
          }
        ],
        "module_path": "src/app/api/runtime/chat/runtime/intentDisambiguationRuntime.ts",
        "recorded_at": "2026-02-19T05:13:49.065Z",
        "function_name": "emit:POLICY_DECISION"
      },
      "selected_indexes": [
        1
      ],
      "selected_intents": [
        "order_change"
      ],
      "source_text_used": true,
      "source_text_present": true
    }


TURN_ID: 2f616450-5cea-4d3e-8363-5682bb44d9a4

[TOKEN_USED]

USER:
101010

BOT:
인증이 완료되었습니다.
입력하신 주소로 우편번호를 찾지 못했어요. 도로명/지번 주소를 다시 입력해주세요.
RESPONSE_SCHEMA: view=text, choice_mode=single, quick_replies=0, cards=0
RESPONSE_SCHEMA_DETAIL:
  {
    "message": "인증이 완료되었습니다.\n입력하신 주소로 우편번호를 찾지 못했어요. 도로명/지번 주소를 다시 입력해주세요.",
    "ui_hints": {
      "view": "text",
      "choice_mode": "single"
    },
    "quick_replies": [],
    "cards": []
  }
RENDER_PLAN: view=text, quick_replies=false, cards=false, mode=single, min=1, max=1, submit=single, prompt=-
RENDER_PLAN_DETAIL:
  {
    "view": "text",
    "enable_quick_replies": false,
    "enable_cards": false,
    "interaction_scope": "latest_only",
    "quick_reply_source": {
      "type": "none"
    },
    "selection_mode": "single",
    "min_select": 1,
    "max_select": 1,
    "submit_format": "single",
    "grid_columns": {
      "quick_replies": 1,
      "cards": 1
    },
    "prompt_kind": null,
    "debug": {
      "policy_version": "v1",
      "quick_replies_count": 0,
      "cards_count": 0,
      "selection_mode_source": "default",
      "min_select_source": "default",
      "max_select_source": "default",
      "submit_format_source": "default"
    }
  }
QUICK_REPLY_RULE: mode=single, min=1, max=1, submit=single, source=none, criteria=-, module=-, function=-

[TOKEN_UNUSED]
DEBUG 로그:
- f6300fe5-004e-4e9d-a13c-f91d31e33e56 (turn_id=2f616450-5cea-4d3e-8363-5682bb44d9a4) (2026-02-19T05:14:15.103+00:00)
  prefix_json:
    {
      "mcp": {
        "last": {
          "error": "MISSING_ZIPCODE: Zipcode is required and could not be auto-found. Please ask the user for their zipcode (우편번호).",
          "status": "error",
          "function": "update_order_shipping_address",
          "result_count": null
        }
      },
      "slot": {
        "phone": "01093107159",
        "address": "1",
        "order_id": "20260127-0000014",
        "phone_masked": "*******7159",
        "expected_input": "otp_code"
      },
      "context": {
        "contamination": [
          "zipcode | ZIPCODE_CARRYOVER_BLOCKED_BY_EXPECTED_INPUT | CLEARED | candidate=08793"
        ],
        "contamination_count": 1
      },
      "decision": {
        "line": 152,
        "phase": "runtime",
        "column": 0,
        "call_chain": [
          {
            "line": 152,
            "column": 0,
            "module_path": "src/app/api/runtime/chat/runtime/runtimeTurnIo.ts",
            "function_name": "insertTurnWithDebug"
          }
        ],
        "module_path": "src/app/api/runtime/chat/runtime/runtimeTurnIo.ts",
        "recorded_at": "2026-02-19T05:14:14.826Z",
        "function_name": "insertTurnWithDebug"
      },
      "kb_admin": {
        "rule_ids": [
          "R270_order_change_allow_write",
          "R268_order_change_need_zipcode_tool",
          "R271_order_change_force_update"
        ],
        "kb_user_id": "f29567ba-275a-4cd9-add8-fa7b3d6e54c2",
        "kb_admin_ids": [
          "878b3ffe-2e18-4820-bda6-ffeccaa4212b",
          "0da02c01-aad4-4286-a445-4db7a89f8ebe"
        ],
        "template_ids": [
          "order_change_need_zipcode"
        ],
        "tool_policies": [
          "update_order_shipping_address"
        ]
      },
      "execution": {
        "call_chain": [
          {
            "module_path": "src/app/api/runtime/chat/runtime/runtimeOrchestrator.ts",
            "function_name": "POST"
          },
          {
            "module_path": "src/app/api/runtime/chat/runtime/runtimeBootstrap.ts",
            "function_name": "bootstrapRuntime"
          },
          {
            "module_path": "src/app/api/runtime/chat/runtime/runtimeInitializationRuntime.ts",
            "function_name": "initializeRuntimeState"
          },
          {
            "module_path": "src/app/api/runtime/chat/runtime/intentDisambiguationRuntime.ts",
            "function_name": "resolveIntentDisambiguation"
          },
          {
            "module_path": "src/app/api/runtime/chat/runtime/preTurnGuardRuntime.ts",
            "function_name": "handlePreTurnGuards"
          },
          {
            "module_path": "src/app/api/runtime/chat/runtime/slotDerivationRuntime.ts",
            "function_name": "deriveSlotsForTurn"
          },
          {
            "module_path": "src/app/api/runtime/chat/runtime/pendingStateRuntime.ts",
            "function_name": "handleAddressChangeRefundPending"
          },
          {
            "module_path": "src/app/api/runtime/chat/runtime/restockPendingRuntime.ts",
            "function_name": "handleRestockPendingStage"
          },
          {
            "module_path": "src/app/api/runtime/chat/runtime/postActionRuntime.ts",
            "function_name": "handlePostActionStage"
          },
          {
            "module_path": "src/app/api/runtime/chat/runtime/contextResolutionRuntime.ts",
            "function_name": "resolveIntentAndPolicyContext"
          },
          {
            "module_path": "src/app/api/runtime/chat/runtime/runtimeInputStageRuntime.ts",
            "function_name": "runInputStageRuntime"
          },
          {
            "module_path": "src/app/api/runtime/chat/runtime/runtimeMcpOpsRuntime.ts",
            "function_name": "createRuntimeMcpOps"
          },
          {
            "module_path": "src/app/api/runtime/chat/runtime/otpRuntime.ts",
            "function_name": "handleOtpLifecycleAndOrderGate"
          },
          {
            "module_path": "src/app/api/runtime/chat/services/dataAccess.ts",
            "function_name": "resolveProductDecision"
          },
          {
            "module_path": "src/app/api/runtime/chat/runtime/toolStagePipelineRuntime.ts",
            "function_name": "runToolStagePipeline"
          }
        ]
      },
      "slot_flow": {
        "expected_inputs": [
          "otp_code"
        ],
        "expected_input_prev": "otp_code",
        "expected_input_stage": "auth_gate.otp.awaiting_code",
        "expected_input_source": "contract_stage"
      },
      "tool_allowlist": {
        "valid_tool_count": 15,
        "resolved_tool_ids": [
          "11025bb2-770a-4c55-af11-83ba2caabcb8",
          "a9cd0a00-59f1-43fd-97d4-5f5c1bca3c07",
          "bc06a0c1-8f40-4ba8-9668-682170254b34",
          "aec3bd90-314a-4929-9fe5-6ed33888857c",
          "ffb90354-4eb0-4dd8-9ba1-d6608a1ea79b",
          "4b4cec22-7d1b-4c06-8579-08cdfbacc16b",
          "56cef951-28f5-4b11-85f5-7624adc15862",
          "0908279c-a369-4684-92ac-8a9f5af1407f",
          "c962d4b0-d96a-45f6-a985-59b8b93534c0",
          "bc9adf5e-e09f-4eed-9391-16aab9e3957a",
          "c78fe2ef-9925-45bf-8f14-2f5954dfb00c",
          "03b67d63-e22d-4820-b101-bf545df8e78c",
          "6780420a-3574-4a0f-97d4-5ce43e7ac21e",
          "1d09fb43-4ca8-4c4c-940f-8ac1bbb43a13",
          "f45fa968-4bfe-4025-a74c-8f14f241bb43"
        ],
        "tools_by_id_count": 15,
        "allowed_tool_count": 15,
        "allowed_tool_names": [
          "cafe24:read_shipping",
          "cafe24:read_order_settings",
          "cafe24:create_ticket",
          "cafe24:lookup_order",
          "cafe24:track_shipment",
          "cafe24:read_product",
          "cafe24:read_supply",
          "cafe24:update_order_settings",
          "juso:search_address",
          "cafe24:api_get_customers_member_id_autoupdate_0d586802",
          "solapi:send_otp",
          "solapi:verify_otp",
          "cafe24:list_orders",
          "cafe24:update_order_shipping_address",
          "cafe24:resolve_product"
        ],
        "provider_selections": [],
        "resolved_tool_count": 15,
        "requested_tool_count": 15,
        "tools_by_provider_count": 0,
        "provider_selection_count": 0,
        "missing_tools_expected_by_intent": [
          "find_customer_by_phone"
        ]
      },
      "model_resolution": {
        "input_length": 6,
        "length_rule_hit": null,
        "keyword_rule_hit": null,
        "selection_reason": "deterministic_or_skipped"
      },
      "policy_conflicts": {
        "conflicts": [
          {
            "kind": "FORCE_RESPONSE_VS_FORCE_TOOL",
            "ruleA": "R268_order_change_need_zipcode_tool",
            "ruleB": "R271_order_change_force_update",
            "stage": "tool",
            "intentScope": "order_change"
          }
        ],
        "resolution": "tool_stage_force_response_precedence"
      }
    }
문제 요약:
- MCP.last_error: MISSING_ZIPCODE: Zipcode is required and could not be auto-found. Please ask the user for their zipcode (우편번호).
- search_address: status=error
- cafe24:update_order_shipping_address: Zipcode is required and could not be auto-found. Please ask the user for their zipcode (우편번호).
MCP 로그:
- ad2d7f78-9447-49f2-911d-2a686c7632e9 search_address@-: error (2026-02-19T05:14:14.558+00:00) (turn_id=2f616450-5cea-4d3e-8363-5682bb44d9a4)
  request:
    {
      "keyword": "1",
      "search_keywords": [
        "1"
      ]
    }
  response:
    {
      "error": "Address search failed. See debug info."
    }
- acda1dca-722e-458e-ab29-d5ad9c5e24b9 cafe24:update_order_shipping_address@1.0: error (2026-02-19T05:14:13.882+00:00) (turn_id=2f616450-5cea-4d3e-8363-5682bb44d9a4)
  request:
    {
      "path": "/orders/{order_id}/receivers",
      "method": "PUT",
      "zipcode": "",
      "address1": "1",
      "address2": "",
      "order_id": "20260127-0000014",
      "cellphone": "01093107159",
      "required_scope": "mall.write_order",
      "customer_verification_token": "3b869dd3-eb2a-4cf3-9107-427f2dcfb0bb"
    }
  response:
    {
      "error": {
        "code": "MISSING_ZIPCODE",
        "message": "Zipcode is required and could not be auto-found. Please ask the user for their zipcode (우편번호)."
      }
    }
- aeb9f4c4-cda1-44b9-9022-6f8c57d482c8 solapi:verify_otp@1.0: success (2026-02-19T05:14:10.736+00:00) (turn_id=2f616450-5cea-4d3e-8363-5682bb44d9a4)
  request:
    {
      "code": "101010",
      "path": "/otp/verify",
      "method": "POST",
      "otp_ref": "0e453347-2954-45df-9db9-c7c41f59f7a2",
      "required_scope": "messaging.write"
    }
  response:
    {
      "verified": true,
      "customer_verification_token": "3b869dd3-eb2a-4cf3-9107-427f2dcfb0bb"
    }
이벤트 로그:
- 7c18dfe5-79f2-4a9c-b61d-247c46e4ad9d EXECUTION_GUARD_TRIGGERED (2026-02-19T05:14:29.066+00:00) (turn_id=2f616450-5cea-4d3e-8363-5682bb44d9a4)
  payload:
    {
      "tool": "update_order_shipping_address",
      "error": "MISSING_ZIPCODE: Zipcode is required and could not be auto-found. Please ask the user for their zipcode (우편번호).",
      "reason": "MISSING_ZIPCODE",
      "_decision": {
        "line": 125,
        "phase": "runtime",
        "column": 0,
        "call_chain": [
          {
            "line": 125,
            "column": 0,
            "module_path": "src/app/api/runtime/chat/handlers/orderChangeHandler.ts",
            "function_name": "emit:EXECUTION_GUARD_TRIGGERED"
          }
        ],
        "module_path": "src/app/api/runtime/chat/handlers/orderChangeHandler.ts",
        "recorded_at": "2026-02-19T05:14:29.066Z",
        "function_name": "emit:EXECUTION_GUARD_TRIGGERED"
      }
    }
- 16b0a131-1587-4ed1-9e00-2b00f2d39171 RUNTIME_SELF_UPDATE_REVIEW_COMPLETED (2026-02-19T05:14:28.802+00:00) (turn_id=2f616450-5cea-4d3e-8363-5682bb44d9a4)
  payload:
    {
      "org_id": "8ad81b6b-3210-40dd-8e00-9a43a4395923",
      "turn_id": "2f616450-5cea-4d3e-8363-5682bb44d9a4",
      "session_id": "b72aa142-82e3-46bb-9e9a-3bc46a783090",
      "proposal_count": 2,
      "violation_count": 2,
      "deduped_violation_count": 0
    }
- c0737a9b-6158-4acf-a4c9-338788a7e929 RUNTIME_PATCH_PROPOSAL_CREATED (2026-02-19T05:14:28.53+00:00) (turn_id=2f616450-5cea-4d3e-8363-5682bb44d9a4)
  payload:
    {
      "title": "Principle violation patch proposal",
      "org_id": "8ad81b6b-3210-40dd-8e00-9a43a4395923",
      "status": "pending",
      "trigger": "runtime_turn_write",
      "turn_id": "2f616450-5cea-4d3e-8363-5682bb44d9a4",
      "rationale": "Prefer runtime decision-path fix over principle text changes (force_template_misapplied=false, expected_input=otp_code, policy_reason=-)",
      "confidence": 0.7,
      "created_at": "2026-02-19T05:14:28.263Z",
      "session_id": "b72aa142-82e3-46bb-9e9a-3bc46a783090",
      "why_failed": "Address slot was already resolved, but final response selection re-asked address.",
      "change_plan": [
        "At final response stage, if expected_input=address and resolved address exists, forbid address prompt template.",
        "If policy decision is DEFER_FORCE_RESPONSE_TEMPLATE with ORDER_AND_ADDRESS_ALREADY_AVAILABLE, preserve decision through finalization.",
        "Emit explicit debug evidence (resolved_address / policy_decision_reason / final_template) around failure boundary."
      ],
      "proposal_id": "rp_1771478065706_1786xb",
      "target_files": [
        "src/app/api/runtime/chat/runtime/finalizeRuntime.ts",
        "src/app/api/runtime/chat/handlers/restockHandler.ts",
        "src/app/api/runtime/chat/runtime/runtimeInputStageRuntime.ts"
      ],
      "violation_id": "pv_b72aa142-82e3-46bb-9e9a-3bc46a783090_2f616450-5cea-4d3e-8363-5682bb44d9a4_memoryno_repeat_address_question",
      "principle_key": "memory.enforceNoRepeatQuestions",
      "runtime_scope": "chat",
      "how_to_improve": "Use finalized slot/policy decision evidence to block address re-ask in final response path; add guard in runtime finalize/handler path.",
      "self_heal_gate": {
        "track": "contract",
        "gate_version": "v1",
        "exception_stats": {
          "repeat_count_7d": 13,
          "repeat_count_30d": 13
        },
        "promotion_reason": "-",
        "contract_fields_ok": false,
        "promotion_required": false,
        "exception_fields_ok": false,
        "evidence_contract_ok": false,
        "case_specific_signals": [],
        "exception_fingerprint": "ex:memory.enforcenorepeatquestions:memoryno_repeat_address_question:-:-",
        "missing_contract_fields": [
          "contract_scope",
          "generalization_scope",
          "slot_request_mapping_strategy",
          "response_projection_strategy",
          "pre_post_invariant_strategy",
          "contract_expectation"
        ],
        "missing_evidence_fields": [
          "policy_decision_reason",
          "final_response_forced_template_applied"
        ],
        "missing_exception_fields": [
          "exception_reason",
          "exception_scope",
          "exception_expiry",
          "promotion_plan",
          "promotion_trigger",
          "blast_radius"
        ]
      },
      "suggested_diff": null,
      "issue_fingerprint": "memory.enforcenorepeatquestions|chat|인증이 완료되었습니다. 입력하신 주소로 우편번호를 찾지 못했어요. 도로명/지번 주소를 다시 입력해주세요.|address was already known but the bot asked for address again.|||otp_code|"
    }
- 9efc2aee-c158-44c0-889d-457144d3b185 PRINCIPLE_VIOLATION_DETECTED (2026-02-19T05:14:28.263+00:00) (turn_id=2f616450-5cea-4d3e-8363-5682bb44d9a4)
  payload:
    {
      "org_id": "8ad81b6b-3210-40dd-8e00-9a43a4395923",
      "summary": "Address was already known but the bot asked for address again.",
      "trigger": "runtime_turn_write",
      "evidence": {
        "answer": "인증이 완료되었습니다.\n입력하신 주소로 우편번호를 찾지 못했어요. 도로명/지번 주소를 다시 입력해주세요.",
        "expected_input": "otp_code",
        "known_address_count": 1,
        "expected_reuse_order": [
          "derived",
          "prevEntity",
          "prevTranscript",
          "recentEntity"
        ],
        "slot_resolved_address": "1",
        "policy_decision_action": null,
        "policy_decision_reason": null,
        "force_template_misapplied": false,
        "user_provided_address_count": 1,
        "user_provided_addresses_tail": [
          "1"
        ],
        "final_response_resolved_address": null,
        "final_response_forced_template_applied": null,
        "final_response_forced_template_skipped_reason": null
      },
      "severity": "medium",
      "violation_id": "pv_b72aa142-82e3-46bb-9e9a-3bc46a783090_2f616450-5cea-4d3e-8363-5682bb44d9a4_memoryno_repeat_address_question",
      "principle_key": "memory.enforceNoRepeatQuestions",
      "runtime_scope": "chat",
      "baseline_source": "src/app/api/runtime/chat/policies/principles.ts",
      "issue_fingerprint": "memory.enforcenorepeatquestions|chat|인증이 완료되었습니다. 입력하신 주소로 우편번호를 찾지 못했어요. 도로명/지번 주소를 다시 입력해주세요.|address was already known but the bot asked for address again.|||otp_code|"
    }
- bb2c0d7e-d277-4b59-8317-bb8e5e23cb8d RUNTIME_PATCH_PROPOSAL_CREATED (2026-02-19T05:14:25.163+00:00) (turn_id=2f616450-5cea-4d3e-8363-5682bb44d9a4)
  payload:
    {
      "title": "External action lifecycle outcome audit proposal",
      "org_id": "8ad81b6b-3210-40dd-8e00-9a43a4395923",
      "status": "pending",
      "trigger": "runtime_turn_write",
      "turn_id": "2f616450-5cea-4d3e-8363-5682bb44d9a4",
      "rationale": "Lifecycle evidence gap (missing_completed=ADDRESS_SEARCH, outcomes=MCP_TOOL_FAILED)",
      "confidence": 0.7,
      "created_at": "2026-02-19T05:14:24.898Z",
      "session_id": "b72aa142-82e3-46bb-9e9a-3bc46a783090",
      "why_failed": "Completion-like user answer was emitted while external action lifecycle evidence was incomplete (STARTED/COMPLETED/outcome mismatch).",
      "change_plan": [
        "Define a shared action lifecycle registry with event stem, start/completion events, and terminal outcomes.",
        "At completion-like final response branch, verify lifecycle evidence deterministically before rendering completion text.",
        "Emit normalized ACTION_* lifecycle events for non-MCP external integrations, not only SMS."
      ],
      "proposal_id": "rp_1771478062154_hcl61z",
      "target_files": [
        "src/app/api/runtime/chat/runtime/runtimeOrchestrator.ts",
        "src/app/api/runtime/chat/runtime/runtimeTurnIo.ts",
        "src/app/api/runtime/governance/_lib/detector.ts",
        "src/app/api/runtime/governance/selfHeal/principles.ts"
      ],
      "violation_id": "pv_b72aa142-82e3-46bb-9e9a-3bc46a783090_2f616450-5cea-4d3e-8363-5682bb44d9a4_actionlifecycle_outcome_missing",
      "principle_key": "action.enforceLifecycleOutcomeAudit",
      "runtime_scope": "chat",
      "how_to_improve": "Enforce generic action lifecycle contract: STARTED -> COMPLETED and terminal outcome event before completion-like response.",
      "self_heal_gate": {
        "track": "contract",
        "gate_version": "v1",
        "exception_stats": {
          "repeat_count_7d": 0,
          "repeat_count_30d": 0
        },
        "promotion_reason": "-",
        "contract_fields_ok": false,
        "promotion_required": false,
        "exception_fields_ok": false,
        "evidence_contract_ok": true,
        "case_specific_signals": [],
        "exception_fingerprint": "ex:action.enforcelifecycleoutcomeaudit:actionlifecycle_outcome_missing:action_lifecycle_outcome_gap:address_search_action",
        "missing_contract_fields": [
          "contract_scope",
          "generalization_scope",
          "slot_request_mapping_strategy",
          "response_projection_strategy",
          "pre_post_invariant_strategy",
          "contract_expectation"
        ],
        "missing_evidence_fields": [],
        "missing_exception_fields": [
          "exception_reason",
          "exception_scope",
          "exception_expiry",
          "promotion_plan",
          "promotion_trigger",
          "blast_radius"
        ]
      },
      "suggested_diff": null,
      "issue_fingerprint": "action.enforcelifecycleoutcomeaudit|chat|external action completion-like answer was produced without deterministic action started/completed/outcome evidence.|external action completion-like answer was produced without deterministic action started/completed/outcome evidence.||||"
    }
- bca9c1d4-2381-4489-b726-d6deb59d0663 PRINCIPLE_VIOLATION_DETECTED (2026-02-19T05:14:24.898+00:00) (turn_id=2f616450-5cea-4d3e-8363-5682bb44d9a4)
  payload:
    {
      "org_id": "8ad81b6b-3210-40dd-8e00-9a43a4395923",
      "summary": "External action completion-like answer was produced without deterministic action STARTED/COMPLETED/outcome evidence.",
      "trigger": "runtime_turn_write",
      "evidence": {
        "tool_name": "address_search_action",
        "intent_name": "order_change",
        "final_answer": "인증이 완료되었습니다.\n입력하신 주소로 우편번호를 찾지 못했어요. 도로명/지번 주소를 다시 입력해주세요.",
        "mismatch_type": "action_lifecycle_outcome_gap",
        "completion_claimed": true,
        "context_action_ids": [
          "20260127-0000014"
        ],
        "outcome_event_types": [
          "MCP_TOOL_FAILED"
        ],
        "started_event_types": [
          "ADDRESS_SEARCH_STARTED"
        ],
        "external_ack_missing_ids": [],
        "external_ack_missing_count": 0,
        "mcp_terminal_outcome_present": true,
        "missing_completed_for_started": [
          "ADDRESS_SEARCH"
        ]
      },
      "severity": "high",
      "violation_id": "pv_b72aa142-82e3-46bb-9e9a-3bc46a783090_2f616450-5cea-4d3e-8363-5682bb44d9a4_actionlifecycle_outcome_missing",
      "principle_key": "action.enforceLifecycleOutcomeAudit",
      "runtime_scope": "chat",
      "baseline_source": "src/app/api/runtime/chat/policies/principles.ts",
      "issue_fingerprint": "action.enforcelifecycleoutcomeaudit|chat|external action completion-like answer was produced without deterministic action started/completed/outcome evidence.|external action completion-like answer was produced without deterministic action started/completed/outcome evidence.||||"
    }
- b6ee736d-0b32-4113-9fc4-dd75d3cb8585 RUNTIME_SELF_UPDATE_REVIEW_STARTED (2026-02-19T05:14:21.323+00:00) (turn_id=2f616450-5cea-4d3e-8363-5682bb44d9a4)
  payload:
    {
      "org_id": "8ad81b6b-3210-40dd-8e00-9a43a4395923",
      "turn_id": "2f616450-5cea-4d3e-8363-5682bb44d9a4",
      "session_id": "b72aa142-82e3-46bb-9e9a-3bc46a783090",
      "config_source": "principles_default"
    }
- 9bb036ab-bca1-43d8-b96c-997e4e67f57a END_USER_WRITE_LATENCY (2026-02-19T05:14:20.241+00:00) (turn_id=2f616450-5cea-4d3e-8363-5682bb44d9a4)
  payload:
    {
      "duration_ms": 4860
    }
- 06306ff1-b3f1-4e87-9eb6-6e6f0181b798 ADDRESS_SEARCH_STARTED (2026-02-19T05:14:14.147+00:00) (turn_id=2f616450-5cea-4d3e-8363-5682bb44d9a4)
  payload:
    {
      "_decision": {
        "phase": "runtime",
        "call_chain": [],
        "module_path": "unknown",
        "recorded_at": "2026-02-19T05:14:14.147Z",
        "function_name": "unknown"
      },
      "query_text": "1"
    }
- 960aaf8c-46f0-4c6f-b3e9-f97c1cbd06be MCP_TOOL_FAILED (2026-02-19T05:14:14.146+00:00) (turn_id=2f616450-5cea-4d3e-8363-5682bb44d9a4)
  payload:
    {
      "tool": "update_order_shipping_address",
      "error": "MISSING_ZIPCODE: Zipcode is required and could not be auto-found. Please ask the user for their zipcode (우편번호).",
      "_decision": {
        "line": 47,
        "phase": "runtime",
        "column": 0,
        "call_chain": [
          {
            "line": 47,
            "column": 0,
            "module_path": "src/app/api/runtime/chat/runtime/postToolRuntime.ts",
            "function_name": "emit:MCP_TOOL_FAILED"
          }
        ],
        "module_path": "src/app/api/runtime/chat/runtime/postToolRuntime.ts",
        "recorded_at": "2026-02-19T05:14:14.145Z",
        "function_name": "emit:MCP_TOOL_FAILED"
      }
    }
- f1fa4dca-a24c-4455-8c12-9eb289c412ae POLICY_CONFLICT_DETECTED (2026-02-19T05:14:12.097+00:00) (turn_id=2f616450-5cea-4d3e-8363-5682bb44d9a4)
  payload:
    {
      "stage": "tool",
      "conflict": "force_response_template vs force_tool_call",
      "_decision": {
        "phase": "runtime",
        "call_chain": [],
        "module_path": "unknown",
        "recorded_at": "2026-02-19T05:14:12.097Z",
        "function_name": "unknown"
      },
      "resolution": "force_response_template_precedence",
      "matched_rule_ids": [
        "R270_order_change_allow_write",
        "R268_order_change_need_zipcode_tool",
        "R271_order_change_force_update"
      ]
    }
- 0ef6ab1b-73a0-4084-af6b-e222839fb962 PRE_MCP_DECISION (2026-02-19T05:14:11.82+00:00) (turn_id=2f616450-5cea-4d3e-8363-5682bb44d9a4)
  payload:
    {
      "denied": [],
      "entity": {
        "order_id": "20260127-0000014",
        "has_address": true,
        "phone_masked": "*******7159"
      },
      "intent": "order_change",
      "allowed": [
        "update_order_shipping_address",
        "list_orders",
        "lookup_order",
        "search_address",
        "send_otp",
        "verify_otp"
      ],
      "_decision": {
        "line": 657,
        "phase": "before",
        "column": 0,
        "call_chain": [
          {
            "line": 657,
            "column": 0,
            "module_path": "src/app/api/runtime/chat/runtime/toolRuntime.ts",
            "function_name": "emit:PRE_MCP_DECISION"
          }
        ],
        "module_path": "src/app/api/runtime/chat/runtime/toolRuntime.ts",
        "recorded_at": "2026-02-19T05:14:11.820Z",
        "function_name": "emit:PRE_MCP_DECISION"
      },
      "query_text": "101010",
      "final_calls": [
        {
          "args": {
            "zipcode": "",
            "address1": "1",
            "address2": "",
            "order_id": "20260127-0000014",
            "cellphone": "01093107159",
            "customer_verification_token": "3b869dd3-eb2a-4cf3-9107-427f2dcfb0bb"
          },
          "name": "update_order_shipping_address"
        }
      ],
      "forced_calls": [
        {
          "args": {
            "zipcode": "",
            "address1": "1",
            "address2": "",
            "order_id": "20260127-0000014",
            "cellphone": "01093107159",
            "customer_verification_token": "3b869dd3-eb2a-4cf3-9107-427f2dcfb0bb"
          },
          "name": "update_order_shipping_address"
        }
      ],
      "query_source": "current_message",
      "missing_slots": [],
      "resolved_slots": {},
      "policy_conflicts": [
        {
          "kind": "FORCE_RESPONSE_VS_FORCE_TOOL",
          "ruleA": "R268_order_change_need_zipcode_tool",
          "ruleB": "R271_order_change_force_update",
          "stage": "tool",
          "intentScope": "order_change"
        }
      ],
      "allowed_tool_names": [
        "cafe24:update_order_shipping_address"
      ],
      "blocked_by_missing_slots": false,
      "allowed_tool_names_total": 15
    }
- 748b1ee7-5af8-4b6f-94c6-e7ec42e56ce0 EXECUTION_GUARD_TRIGGERED (2026-02-19T05:14:11.553+00:00) (turn_id=2f616450-5cea-4d3e-8363-5682bb44d9a4)
  payload:
    {
      "tool": "update_order_shipping_address",
      "error": "MUTATION_INTENT_NOT_READY",
      "reason": "MISSING_REQUIRED_SLOTS",
      "missing": {
        "address": false,
        "zipcode": true,
        "order_id": false
      },
      "_decision": {
        "line": 125,
        "phase": "runtime",
        "column": 0,
        "call_chain": [
          {
            "line": 125,
            "column": 0,
            "module_path": "src/app/api/runtime/chat/handlers/orderChangeHandler.ts",
            "function_name": "emit:EXECUTION_GUARD_TRIGGERED"
          }
        ],
        "module_path": "src/app/api/runtime/chat/handlers/orderChangeHandler.ts",
        "recorded_at": "2026-02-19T05:14:11.553Z",
        "function_name": "emit:EXECUTION_GUARD_TRIGGERED"
      }
    }
- 64478f0d-7a7c-4f95-a5f0-5338b53a685a INTENT_SCOPE_GATE_REVIEW_COMPLETED (2026-02-19T05:14:09.175+00:00) (turn_id=2f616450-5cea-4d3e-8363-5682bb44d9a4)
  payload:
    {
      "intent": "order_change",
      "blocked": false,
      "_decision": {
        "phase": "runtime",
        "call_chain": [],
        "module_path": "unknown",
        "recorded_at": "2026-02-19T05:14:09.175Z",
        "function_name": "unknown"
      },
      "missing_slots": [],
      "required_slots": [],
      "resolved_slots": {}
    }
- 70b4053e-90e6-42f4-964c-439efc903a95 INTENT_SCOPE_GATE_REVIEW_STARTED (2026-02-19T05:14:08.907+00:00) (turn_id=2f616450-5cea-4d3e-8363-5682bb44d9a4)
  payload:
    {
      "intent": "order_change",
      "_decision": {
        "phase": "runtime",
        "call_chain": [],
        "module_path": "unknown",
        "recorded_at": "2026-02-19T05:14:08.907Z",
        "function_name": "unknown"
      },
      "query_source": "current_message",
      "expected_input": "otp_code"
    }
- c30100e8-8159-4b87-8922-1628a0343ba9 SLOT_EXTRACTED (2026-02-19T05:14:08.64+00:00) (turn_id=2f616450-5cea-4d3e-8363-5682bb44d9a4)
  payload:
    {
      "derived": {
        "phone": null,
        "address": null,
        "zipcode": null,
        "order_id": null,
        "phone_masked": "-"
      },
      "resolved": {
        "phone": "01093107159",
        "intent": "order_change",
        "address": "1",
        "zipcode": null,
        "order_id": "20260127-0000014",
        "phone_masked": "*******7159"
      },
      "_decision": {
        "line": 145,
        "phase": "runtime",
        "column": 0,
        "call_chain": [
          {
            "line": 145,
            "column": 0,
            "module_path": "src/app/api/runtime/chat/runtime/runtimeInputStageRuntime.ts",
            "function_name": "emit:SLOT_EXTRACTED"
          }
        ],
        "module_path": "src/app/api/runtime/chat/runtime/runtimeInputStageRuntime.ts",
        "recorded_at": "2026-02-19T05:14:08.640Z",
        "function_name": "emit:SLOT_EXTRACTED"
      },
      "query_source": "current_message",
      "missing_slots": [],
      "expected_input": "otp_code",
      "resolved_slots": {}
    }
- e67f117b-e41a-4c3c-9c03-98bce5f6b7e4 POLICY_STATIC_CONFLICT (2026-02-19T05:14:08.363+00:00) (turn_id=2f616450-5cea-4d3e-8363-5682bb44d9a4)
  payload:
    {
      "intent": "order_change",
      "_decision": {
        "line": 42,
        "phase": "runtime",
        "column": 0,
        "call_chain": [
          {
            "line": 42,
            "column": 0,
            "module_path": "src/app/api/runtime/chat/runtime/policyInputRuntime.ts",
            "function_name": "emit:POLICY_STATIC_CONFLICT"
          }
        ],
        "module_path": "src/app/api/runtime/chat/runtime/policyInputRuntime.ts",
        "recorded_at": "2026-02-19T05:14:08.363Z",
        "function_name": "emit:POLICY_STATIC_CONFLICT"
      },
      "conflicts": [
        {
          "kind": "FORCE_RESPONSE_VS_FORCE_TOOL",
          "ruleA": "R268_order_change_need_zipcode_tool",
          "ruleB": "R271_order_change_force_update",
          "stage": "tool",
          "intentScope": "order_change"
        }
      ],
      "resolution": "tool_stage_force_response_precedence"
    }
- c0e72c32-7aba-4bb1-8601-05a8c2cb562d CONTEXT_CONTAMINATION_DETECTED (2026-02-19T05:14:08.098+00:00) (turn_id=2f616450-5cea-4d3e-8363-5682bb44d9a4)
  payload:
    {
      "slot": "zipcode",
      "action": "CLEARED",
      "reason": "ZIPCODE_CARRYOVER_BLOCKED_BY_EXPECTED_INPUT",
      "_decision": {
        "phase": "runtime",
        "call_chain": [],
        "module_path": "unknown",
        "recorded_at": "2026-02-19T05:14:08.098Z",
        "function_name": "unknown"
      },
      "candidate": "08793",
      "expected_input": "otp_code"
    }