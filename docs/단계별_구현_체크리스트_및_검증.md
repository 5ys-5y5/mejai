# 단계별 구현 체크리스트 및 검증 (Exit Criteria)

이 문서는 Mejai Help MVP의 진행 현황을 **중복 없이** 정리한 최신 체크리스트입니다.  
업데이트 기준일: **2026-02-05**

체크 기준:
- [x] 코드/파일/로컬 실행으로 확인됨
- [ ] 미구현, 미검증, 또는 운영환경 확인 필요

---

## 0) 의사결정 로그 (완료)

- [x] WebSocket 서버 구성 선택: 별도 WS 서버(`ws` 패키지) 추가
- [x] 주문 조치 범위 확정: `lookup_order`, `track_shipment`, `create_ticket`
- [x] LLM SDK/WS 패키지 설치 승인: `openai`, `@google/generative-ai`, `ws`
- [x] KB 임베딩 파이프라인 방식 확정: 작성/수정 시 즉시 생성(동기식)

---

## 1) Phase 1: Project Setup & Foundation (완료)

- [x] Next.js 프로젝트 초기 구성 (TypeScript, Tailwind, App Router)
- [x] 공통 UI/유틸 컴포넌트 구성 (`src/components/ui`, `cn`)
- [x] 앱 셸/네비/헬프패널 구조 구성 (`AppShell`, `AppHeader`, `AppSidebar`, `HelpPanel`)
- [x] 인증 페이지 구성 (`/login`, `/signup`, `/verify`, `/forgot`, `/onboarding`)
- [x] 인증 보호 레이아웃 구성 (`RequireAuth`)

---

## 2) Phase 2: Operator Console UI (완료)

- [x] 대시보드/세션목록/세션상세 페이지 구현
- [x] 통화 중 웹 입력 페이지 구현 (`/call/[token]`)
- [x] 운영자 콘솔 페이지 구현 (`/app/review`, `/app/agents`, `/app/eval`, `/app/kb`, `/app/rules`, `/app/settings`, `/app/billing`, `/app/team`, `/app/audit`)
- [x] 랜딩 페이지 구현 및 Spline iframe 임베드 적용
- [x] 비교 페이지 구현 (`/app/laboratory`)

---

## 3) Phase 3: Backend & DB Integration (진행 중)

### 3-1) 핵심 실통화 루프 (운영 검증 필요)
- [ ] 실제 통화 수신 Webhook/Provider(Twilio/Telnyx) 연동 검증
- [ ] 통화 세션 생성 시 agent/KB 바인딩 검증
- [ ] 질문 -> LLM 프롬프트(조직/규칙/KB) 구성 실통화 검증
- [ ] KB(RAG) 결과가 LLM 응답에 반영되는지 실통화 검증
- [ ] LLM 응답의 TTS 변환/송출 검증
- [ ] 통화 종료 후 세션/턴/이벤트 DB 기록 검증

### 3-2) 데이터/인증 기반
- [x] Supabase Auth 기반 사용자 인증 플로우
- [x] 온보딩 조직 생성 + org_id 데이터 연동
- [ ] API 계약서 최신본 경로/파일 재정리 (`docs/api_contract.md`는 현재 워크트리에서 삭제 상태)
- [x] RLS 기반 멀티테넌시 접근 흐름(코드 레벨)
- [x] 에이전트/KB 버전 정책 정비
- [x] DB 제약/인덱스 보강 로직 반영

### 3-3) API 구현 상태
- [x] 세션/턴/오디오/이벤트/리뷰큐/KB 읽기 API
- [x] 세션/턴/오디오/이벤트/리뷰큐/KB 쓰기 API
- [x] 통화 시뮬레이션 API (`/api/simulate-call`) 및 더미 생성 로직
- [x] 단계 처리 API (`/api/sessions/{id}/process`)
- [x] 대시보드/세션조회/로그조회/KB조회 API 연동
- [ ] Rules 전용 백엔드 관리 API 정비(운영 기준)

### 3-4) MCP/Cafe24
- [x] MCP 도구 목록/호출 API (`/api/mcp/tools`, `/api/mcp/tools/call`)
- [x] MCP 호출 시 org/user 컨텍스트 전달
- [x] MCP 관리자 권한 체크(`A_iam_user_access_maps.is_admin`) 반영
- [x] `MCP_TOKEN` 환경변수 fallback 제거
- [x] Cafe24 토큰 갱신 에러 코드(`TOKEN_REFRESH_FAILED`) 반환 로직 존재
- [x] 주기 갱신 API(`/api/cafe24/refresh`)의 `CRON_SECRET` 보호 로직 존재
- [ ] `/api/cafe24/authorize`의 DB 설정 사용 항목 재검증 필요
  - 현재 코드 기준: `mall_id`는 DB fallback, `client_id`/기본 `scope`는 ENV 기반
- [ ] `/api/cafe24/callback`의 DB 직접 저장
  - 현재 코드 기준: 콜백은 `postMessage` 전달, 저장은 설정 화면에서 `/api/auth-settings/providers` 호출로 수행
- [ ] `auth_settings` 테이블/정책/데이터 키 존재 여부(DB 실환경 확인 필요)
- [ ] 도구 허용정책(`mcp_tool_policies`) 실데이터 검증
- [ ] 실제 Cafe24 도구 응답 E2E (`list_boards`, `list_board_articles`, `list_orders`, `find_customer_by_phone`, `lookup_order`, `track_shipment`, `create_ticket`)
- [ ] 만료 임박 토큰만 선택 갱신(현재 코드는 refresh_token 보유 레코드 순회)
- [ ] Railway Cron 30분 주기 호출 운영 확인

### 3-5) 프론트-백엔드 연결
- [x] 대시보드/세션목록/세션상세 읽기 연동
- [x] 리뷰큐/KB 읽기 연동
- [x] 대시보드 시뮬레이션 생성 트리거 UI
- [x] 세션 상세 단계 트리거(수동/자동) UI
- [x] KB 버전 변경 선택/알림 UI
- [ ] 사용자 권한/플랜 스키마 실제 적용(`user_access` SQL)
- [ ] Supabase Storage 기반 녹음 파일 저장/관리
- [ ] Supabase Auth 도메인/SMTP/템플릿 운영 설정

---

## 4) Phase 3.5: Runtime LLM/MCP/KB 통합 (진행 중)

### 4-1) LLM/WS
- [x] OpenAI/Gemini SDK 연동 (`OPENAI_API_KEY`, `GEMINI_API_KEY`)
- [x] 모델 라우팅 (`gpt-4.1-mini`, `gpt-4.1`, `gemini-2.5-flash-lite`, `gemini-2.5-pro`)
- [x] WS 서버 엔트리(`ws-server.js`) + `npm run ws`
- [ ] Railway Start Command를 `npm run ws`로 운영 반영
- [ ] `NEXT_PUBLIC_CALL_WS_URL` 운영 반영
- [ ] Runtime -> WS -> 응답 스트리밍 완전 연결
  - 현재 `ws-server.js`는 `/api/playground/chat` 호출 구조이며, 해당 API 경로는 현재 코드베이스에 없음

### 4-2) KB/RAG
- [x] 작성/수정 시 임베딩 생성(동기식) 코드 존재
- [x] RAG 근거를 `turns.kb_references`에 저장
- [x] `bot_context`를 turns/events/mcp audit에 기록하는 코드 존재
- [ ] `bot_context` 키 스키마 최종 확정(문서/DB 기준)
- [ ] `sessions/review_queue/audio_segments`까지 전 구간 `bot_context` 추적 일관성 검증

### 4-3) 주문 조치/후속 대화
- [x] `order_choices` 기반 후속 주문번호 선택 처리 로직 존재
- [x] 후속 질문에서 intent 재사용 로직 존재
- [x] 선택 order_id를 후속 policy 컨텍스트에 주입하는 로직 존재
- [x] `update_order_shipping_address` 어댑터 구현
- [ ] 주문 변경 성공/실패 시나리오 E2E 검증
- [ ] 실운영 MCP 호출 결과(주문/환불/배송) 검증

---

## 5) Phase 3.6: MK2 재입고/정책 확장 (진행 중)

- [x] 정책 기반 intent/predicate 분기 로직 반영(`runtime/chat/core.ts`)
- [x] mk2 관련 도구 스텁/어댑터(`resolve_product`, `read_product`, `read_supply`, `subscribe_restock`, `trigger_restock`)
- [x] Cafe24 상품/공급/배송 조회 어댑터 구현
- [x] 비교 페이지 및 링크 동선 (`/app/laboratory`)
- [x] mk2 라우팅 로직을 `src/app/api/runtime/chat/core.ts`로 통합
- [ ] `/api/runtime/chat/shipping` 별도 엔드포인트
- [ ] mk2 SQL/정책팩 문서 파일 재정리 (현재 워크트리 기준 `docs/mk2/*` 삭제 상태)
- [ ] `mcp_tools`/`mcp_tool_policies` DB 반영 실검증
- [ ] 재입고 알림 구독 E2E (`subscribe_restock` -> `restock_subscription`)

---

## 6) Phase 4: Testing & Finalization (대기)

- [ ] 단위/통합 테스트 (목표 커버리지 >70%)
- [ ] 핵심 사용자 플로우 E2E 테스트
- [ ] MVP 완료 기준 최종 검토

---

## 7) 로컬 실행 검증 스냅샷 (2026-02-05)

- [x] 주요 페이지/라우트/핵심 파일 존재 확인
- [x] 포트 `8080` 리스닝 확인(`netstat -ano | findstr :8080`)
- [ ] `npm run lint` 통과
  - 현재 결과: **실패(184 errors, 59 warnings)**


참고: 실운영 실행 검증 항목은 docs/실운영_실행_검증_체크리스트.md를 사용합니다.
