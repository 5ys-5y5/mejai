# 질문
const key = Object.keys(localStorage).find(k => k.includes("auth-token"));
const raw = localStorage.getItem(key || "");
const token = raw ? (JSON.parse(raw).access_token || JSON.parse(atob(raw)).access_token) : "";

fetch("/api/mcp/tools/call", {
  method: "POST",
  headers: { "Content-Type": "application/json", "Authorization": "Bearer " + token },
  body: JSON.stringify({ tool: "find_customer_by_phone", params: { member_id: "mejai", debug: true } })
}).then(r => r.json())
  .then(res => console.log(JSON.stringify(res)));

fetch("/api/mcp/tools/call", {
  method: "POST",
  headers: { "Content-Type": "application/json", "Authorization": "Bearer " + token },
  body: JSON.stringify({ tool: "lookup_order", params: { order_id: "20260127-0000014", customer_verification_token: "TEST", debug: true } })
}).then(r => r.json())
  .then(res => console.log(JSON.stringify(res)));
Promise{<pending>}
VM1391:10 {"tool":"find_customer_by_phone","version":"v1","status":"success","data":{"customers":[{"shop_no":1,"member_id":"mejai","group_no":1,"member_authentication":"T","use_blacklist":"F","blacklist_type":"","authentication_method":null,"sms":"F","news_mail":"F","solar_calendar":"T","total_points":"0.00","available_points":"0.00","used_points":"0.00","last_login_date":"2026-01-27T01:47:14+09:00","gender":"","use_mobile_app":"F","available_credits":"0.00","created_date":"2026-01-27T01:47:14+09:00","fixed_group":"F"}],"_debug":[{"query":{"shop_no":"1","member_id":"mejai"},"ok":true,"hasCustomers":true}]},"error":null,"meta":{"latency_ms":278}}
VM1391:17 {"tool":"lookup_order","version":"v1","status":"success","data":{"order":{"shop_no":1,"currency":"KRW","order_id":"20260127-0000014","market_id":"self","market_order_no":null,"member_id":"mejai","member_authentication":"T","billing_name":"성지용","bank_code":"bank_13","bank_code_name":"농협","payment_method":["cash"],"payment_method_name":["무통장입금"],"payment_gateway_names":null,"sub_payment_method_name":null,"sub_payment_method_code":null,"transaction_ids":null,"paid":"F","canceled":"F","order_date":"2026-01-27T01:49:00+09:00","first_order":"T","payment_date":null,"order_from_mobile":"F","use_escrow":"F","customer_group_no_when_ordering":"1","initial_order_amount":{"order_price_amount":"1000.00","shipping_fee":"2500.00","points_spent_amount":"0.00","credits_spent_amount":"0.00","coupon_discount_price":"0.00","coupon_shipping_fee_amount":"0.00","membership_discount_amount":"0.00","shipping_fee_discount_amount":"0.00","set_product_discount_amount":"0.00","app_discount_amount":"0.00","point_incentive_amount":"0.00","total_amount_due":"3500.00","payment_amount":"0.00","market_other_discount_amount":"0.00","tax":null},"actual_order_amount":{"order_price_amount":"1000.00","shipping_fee":"2500.00","points_spent_amount":"0.00","credits_spent_amount":"0.00","coupon_discount_price":"0.00","coupon_shipping_fee_amount":"0.00","membership_discount_amount":"0.00","shipping_fee_discount_amount":"0.00","set_product_discount_amount":"0.00","app_discount_amount":"0.00","point_incentive_amount":"0.00","total_amount_due":"3500.00","payment_amount":"0.00","market_other_discount_amount":"0.00","tax":null},"bank_account_no":"3020654717291","bank_account_owner_name":"성지용","market_seller_id":null,"payment_amount":"0.00","cancel_date":null,"order_place_name":"PC쇼핑몰","order_place_id":"self","payment_confirmation":null,"commission":"0.00","postpay":"F","admin_additional_amount":null,"additional_shipping_fee":"0.00","international_shipping_insurance":"0.00","additional_handling_fee":"0.00","shipping_type":"A","shipping_type_text":"국내배송","shipping_status":"F","wished_delivery_date":"","wished_delivery_time":null,"wished_carrier_id":null,"wished_carrier_name":null,"return_confirmed_date":null,"total_supply_price":"1000","naver_point":null,"additional_order_info_list":[],"store_pickup":"F","easypay_name":"","loan_status":null,"subscription":"F","shipping_fee_detail":[{"shipping_group_code":5,"supplier_code":"S0000000","shipping_fee":"2500.00","cancel_shipping_fee":"0.00","additional_shipping_fee":"0.00","refunded_shipping_fee":"0.00","return_shipping_fee":"0.00","items":["20260127-0000014-01"]}],"regional_surcharge_detail":[],"multiple_addresses":"F","exchange_rate":"1.0000","first_payment_methods":["cash"],"naverpay_payment_information":null,"include_tax":"T","tax_detail":null,"service_type":null,"service_data":null,"show_shipping_address":"T","social_member_code":null,"social_name":null}},"error":null,"meta":{"latency_ms":328}}

# 답변
결과 확인 완료. ✅

- `find_customer_by_phone`가 `member_id=mejai`로 **정상 고객 데이터를 반환**했습니다.
- `lookup_order`가 `order_id=20260127-0000014`로 **정상 주문 데이터를 반환**했습니다.
- `_debug`에서도 실제 쿼리/응답이 확인되어 **MCP → Cafe24 연동 정상 동작**이 확정되었습니다.

따라서 1차 목표(환경 변수 없이 Cafe24 MCP 정상 작동)는 **완료** 상태입니다.

다음 단계로 할 수 있는 것
1) `find_customer_by_phone`에 전화번호 매칭 로직 보강(하이픈 제거/변형)
2) `lookup_order`에 배송/취소 상태 요약 필드 추가
3) 개인정보 마스킹 규칙 강화

원하시는 다음 작업을 알려주세요.
