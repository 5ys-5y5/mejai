# 질문
1,2,3 번 순서대로 진행해주세요.

# 답변
요청하신 1,2,3을 순서대로 반영했습니다.

1) `find_customer_by_phone` 전화번호 매칭 보강
- 이미 숫자/하이픈 포맷을 모두 시도하도록 되어 있어 유지
- 디버그로 실제 쿼리 확인 가능

2) `lookup_order` 응답 요약 추가
- `order_summary` 필드 추가: 결제/취소/배송 상태와 총액 요약

3) 개인정보 마스킹 강화
- `lookup_order` 응답에서 다음 필드를 기본 마스킹
  - `billing_name`
  - `bank_account_no`
  - `bank_account_owner_name`
  - `member_id`

수정 파일
- `src/lib/mcpAdapters.ts`

변경 사항 요약
- `maskOptional`, `addOrderSummary`, `maskOrderSensitive`, `formatOrderData` 추가
- `lookup_order` 성공 경로(재시도 포함)에서 요약/마스킹 적용

다음 단계
1) 서버 재시작
2) 아래 호출로 결과 확인 (마스킹/요약 적용 여부 확인)

```js
const key = Object.keys(localStorage).find(k => k.includes("auth-token"));
const raw = localStorage.getItem(key || "");
const token = raw ? (JSON.parse(raw).access_token || JSON.parse(atob(raw)).access_token) : "";

fetch("/api/mcp/tools/call", {
  method: "POST",
  headers: { "Content-Type": "application/json", "Authorization": "Bearer " + token },
  body: JSON.stringify({ tool: "lookup_order", params: { order_id: "20260127-0000014", customer_verification_token: "TEST" } })
}).then(r => r.json()).then(console.log);
```

결과에서 `order_summary`가 추가되고, 민감 필드가 마스킹되어 있으면 완료입니다.
