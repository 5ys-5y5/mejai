# 실운영 실행 검증 체크리스트 (배포/DB/시나리오)

이 문서는 `docs/단계별_구현_체크리스트_및_검증.md`에서 **코드 존재 확인을 제외**하고,
실운영 반영/실행으로만 검증해야 하는 항목을 분리한 체크리스트입니다.

업데이트 기준일: **2026-02-05**

체크 기준:
- [x] 실환경에서 실제 수행 + 결과 증빙 확보
- [ ] 미수행 또는 증빙 부족

증빙 예시:
- 스크린샷, API 응답(JSON), DB 조회 결과, Railway 로그, Supabase 로그

---

## 1) 배포/환경 변수

- [ ] `NEXT_PUBLIC_CALL_WS_URL` 운영값 반영 (프론트)
- [ ] WS 서버 배포 서비스 Start Command를 `npm run ws`로 설정
- [ ] `OPENAI_API_KEY`, `GEMINI_API_KEY` 운영값 확인
- [ ] Cafe24 OAuth 관련 ENV 확인
  - [ ] `CAFE24_CLIENT_ID`
  - [ ] `CAFE24_CLIENT_SECRET_KEY`
  - [ ] `CAFE24_REDIRECT_URI`
  - [ ] `CAFE24_OAUTH_STATE_SECRET`
- [ ] `CRON_SECRET` 운영값 확인

---

## 2) Supabase/Auth 운영 설정

- [ ] Supabase Auth Site URL/Redirect URL 운영 도메인 반영
- [ ] 커스텀 SMTP 연결 검증
- [ ] 인증 메일 템플릿 반영 검증
- [ ] `user_access` 관련 SQL 적용 확인(권한/플랜 스키마)
- [ ] `auth_settings` 테이블/정책/키 구성 운영 DB 점검

---

## 3) Cafe24 OAuth + 토큰 수명

- [ ] 로그인 세션 상태에서 `/api/cafe24/authorize` 접근 시 Cafe24 승인 URL로 이동 확인
- [ ] 승인 완료 후 설정 화면에서 토큰 저장 완료 확인 (`/api/auth-settings/providers`)
- [ ] 저장 후 `A_iam_auth_settings.providers.cafe24` 값 반영 확인
  - [ ] `mall_id`
  - [ ] `access_token`
  - [ ] `refresh_token`
  - [ ] `expires_at`
- [ ] 만료 토큰 조건에서 MCP 호출 시 refresh 동작 확인
- [ ] refresh 실패 시 `TOKEN_REFRESH_FAILED` 응답 확인

---

## 4) MCP 정책/도구 실데이터 검증

- [ ] `C_mcp_tools`에 필요 도구 존재 확인
  - [ ] `list_boards`
  - [ ] `list_board_articles`
  - [ ] `list_orders`
  - [ ] `find_customer_by_phone`
  - [ ] `lookup_order`
  - [ ] `track_shipment`
  - [ ] `create_ticket`
  - [ ] `update_order_shipping_address`
  - [ ] `read_product`
  - [ ] `read_supply`
  - [ ] `read_shipping`
  - [ ] `subscribe_restock`
- [ ] `mcp_tool_policies`에 org 기준 허용 정책 반영 확인
- [ ] 각 도구 호출 성공/실패 케이스 1회 이상 검증
- [ ] 호출 감사로그(`F_audit_mcp_tools`) 적재 확인

---

## 5) Runtime 실통합 검증

- [ ] Runtime -> LLM 응답 생성 확인
- [ ] Runtime -> MCP 호출 -> 응답 병합 확인
- [ ] Runtime -> KB 근거 포함 응답 확인 (`kb_references`)
- [ ] `bot_context` 기록 일관성 확인
  - [ ] `D_conv_turns.bot_context`
  - [ ] `F_audit_events.bot_context`
  - [ ] `F_audit_mcp_tools.bot_context`
- [ ] WS 경유 실시간 응답 송수신 확인(사용자 입력 -> 서버 -> 응답)

---

## 6) 통화 도메인 시나리오 E2E

- [ ] 주문번호 포함 문의 -> `lookup_order` 성공
- [ ] 주문번호 없음 + 휴대폰 기반 조회 -> `list_orders` 후 선택 유도
- [ ] 배송조회 문의 -> `track_shipment` 성공
- [ ] 환불/지원 문의 -> `create_ticket` 성공
- [ ] 배송지 변경 문의 -> `update_order_shipping_address` 성공/실패 분기 검증
- [ ] MCP 실패/정책차단 시 안전 응답 및 로그 확인
- [ ] KB 근거 부족 시 답변 보류/추가질문 동작 확인

---

## 7) 재입고(MK2) 운영 검증

- [ ] 재입고 의도 분류 정확성 점검 (`restock_inquiry`, `restock_subscribe`)
- [ ] `subscribe_restock` 호출 후 `restock_subscription` 저장 확인
- [ ] 재입고 dispatch 경로 동작 확인 (`/api/runtime/restock/dispatch`)
- [ ] 상품/공급/배송 조회 도구(`read_product`, `read_supply`, `read_shipping`) 실응답 검증

---

## 8) 스케줄/배치 운영

- [ ] Railway Cron에서 `/api/cafe24/refresh` 30분 주기 호출 설정
- [ ] 실제 실행 로그에서 주기 호출 확인
- [ ] 불필요 전체갱신 방지 전략 확정(만료 임박 우선 갱신 정책)

---

## 9) 안정화 게이트 (배포 승인 기준)

- [ ] P0 시나리오(주문조회/배송조회/티켓생성/배송지변경) 전부 통과
- [ ] 인증/OAuth/토큰갱신 실패 시 사용자 메시지와 운영 로그가 모두 명확함
- [ ] 관리자 UI에서 정책/도구 상태 확인 가능
- [ ] 장애 대응용 최소 대시보드/로그 조회 경로 확보

---

## 10) 검증 기록 템플릿

아래 형식으로 항목별 증빙을 남깁니다.

```md
- 항목: (예: 배송조회 track_shipment 성공)
- 일시: 2026-02-05 14:30 KST
- 환경: production
- 입력: (요청 payload 요약)
- 결과: 성공/실패
- 증빙: (로그 링크/스크린샷/응답 JSON)
- 비고: (재현 조건, 이슈번호)
```

---

## 11) 검증 기록

- 항목: 실운영 실행 검증 체크리스트 문서 생성/연결
- 일시: 2026-02-05
- 환경: 문서 정비
- 입력: 기존 단계별 체크리스트에서 실운영 검증 항목 분리 요청
- 결과: 성공
- 증빙: `docs/실운영_실행_검증_체크리스트.md` 생성, `docs/단계별_구현_체크리스트_및_검증.md` 참조 문구 추가
- 비고: 실제 운영 검증 수행 시 본 섹션에 항목별로 누적 기록
